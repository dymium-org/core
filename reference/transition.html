<!-- Generated by pkgdown: do not edit by hand -->
<!DOCTYPE html>
<html lang="en">
  <head>
  <meta charset="utf-8">
<meta http-equiv="X-UA-Compatible" content="IE=edge">
<meta name="viewport" content="width=device-width, initial-scale=1.0">

<title>Simulate state transition (Markov chain) — transition • dymiumCore</title>

<!-- favicons -->
<link rel="icon" type="image/png" sizes="16x16" href="../favicon-16x16.png">
<link rel="icon" type="image/png" sizes="32x32" href="../favicon-32x32.png">
<link rel="apple-touch-icon" type="image/png" sizes="180x180" href="../apple-touch-icon.png" />
<link rel="apple-touch-icon" type="image/png" sizes="120x120" href="../apple-touch-icon-120x120.png" />
<link rel="apple-touch-icon" type="image/png" sizes="76x76" href="../apple-touch-icon-76x76.png" />
<link rel="apple-touch-icon" type="image/png" sizes="60x60" href="../apple-touch-icon-60x60.png" />

<!-- jquery -->
<script src="https://cdnjs.cloudflare.com/ajax/libs/jquery/3.4.1/jquery.min.js" integrity="sha256-CSXorXvZcTkaix6Yvo6HppcZGetbYMGWSFlBw8HfCJo=" crossorigin="anonymous"></script>
<!-- Bootstrap -->
<link href="https://cdnjs.cloudflare.com/ajax/libs/bootswatch/3.4.0/readable/bootstrap.min.css" rel="stylesheet" crossorigin="anonymous" />


<script src="https://cdnjs.cloudflare.com/ajax/libs/twitter-bootstrap/3.4.1/js/bootstrap.min.js" integrity="sha256-nuL8/2cJ5NDSSwnKD8VqreErSWHtnEP9E7AySL+1ev4=" crossorigin="anonymous"></script>

<!-- bootstrap-toc -->
<link rel="stylesheet" href="../bootstrap-toc.css">
<script src="../bootstrap-toc.js"></script>

<!-- Font Awesome icons -->
<link rel="stylesheet" href="https://cdnjs.cloudflare.com/ajax/libs/font-awesome/5.12.1/css/all.min.css" integrity="sha256-mmgLkCYLUQbXn0B1SRqzHar6dCnv9oZFPEC1g1cwlkk=" crossorigin="anonymous" />
<link rel="stylesheet" href="https://cdnjs.cloudflare.com/ajax/libs/font-awesome/5.12.1/css/v4-shims.min.css" integrity="sha256-wZjR52fzng1pJHwx4aV2AO3yyTOXrcDW7jBpJtTwVxw=" crossorigin="anonymous" />

<!-- clipboard.js -->
<script src="https://cdnjs.cloudflare.com/ajax/libs/clipboard.js/2.0.6/clipboard.min.js" integrity="sha256-inc5kl9MA1hkeYUt+EC3BhlIgyp/2jDIyBLS6k3UxPI=" crossorigin="anonymous"></script>

<!-- headroom.js -->
<script src="https://cdnjs.cloudflare.com/ajax/libs/headroom/0.11.0/headroom.min.js" integrity="sha256-AsUX4SJE1+yuDu5+mAVzJbuYNPHj/WroHuZ8Ir/CkE0=" crossorigin="anonymous"></script>
<script src="https://cdnjs.cloudflare.com/ajax/libs/headroom/0.11.0/jQuery.headroom.min.js" integrity="sha256-ZX/yNShbjqsohH1k95liqY9Gd8uOiE1S4vZc+9KQ1K4=" crossorigin="anonymous"></script>

<!-- pkgdown -->
<link href="../pkgdown.css" rel="stylesheet">
<script src="../pkgdown.js"></script>


<!-- docsearch -->
<script src="../docsearch.js"></script>
<link rel="stylesheet" href="https://cdnjs.cloudflare.com/ajax/libs/docsearch.js/2.6.3/docsearch.min.css" integrity="sha256-QOSRU/ra9ActyXkIBbiIB144aDBdtvXBcNc3OTNuX/Q=" crossorigin="anonymous" />
<link href="../docsearch.css" rel="stylesheet">
<script src="https://cdnjs.cloudflare.com/ajax/libs/mark.js/8.11.1/jquery.mark.min.js" integrity="sha256-4HLtjeVgH0eIB3aZ9mLYF6E8oU5chNdjU6p6rrXpl9U=" crossorigin="anonymous"></script>



<meta property="og:title" content="Simulate state transition (Markov chain) — transition" />
<meta property="og:description" content="The transition function can be used to evaluate a model againts the attribute
data of an Entity object stored inside the input World object and update
an attribute of that Entity using random draws from the prediction result.
It allows simple state transitions to be simulated directly inside a
microsimulation pipeline, as it always returns the input World object." />
<meta property="og:image" content="https://core.dymium.org/logo.png" />




<!-- mathjax -->
<script src="https://cdnjs.cloudflare.com/ajax/libs/mathjax/2.7.5/MathJax.js" integrity="sha256-nvJJv9wWKEm88qvoQl9ekL2J+k/RWIsaSScxxlsrv8k=" crossorigin="anonymous"></script>
<script src="https://cdnjs.cloudflare.com/ajax/libs/mathjax/2.7.5/config/TeX-AMS-MML_HTMLorMML.js" integrity="sha256-84DKXVJXs0/F8OTMzX4UR909+jtl4G7SPypPavF+GfA=" crossorigin="anonymous"></script>

<!--[if lt IE 9]>
<script src="https://oss.maxcdn.com/html5shiv/3.7.3/html5shiv.min.js"></script>
<script src="https://oss.maxcdn.com/respond/1.4.2/respond.min.js"></script>
<![endif]-->


<!-- Global site tag (gtag.js) - Google Analytics -->
<script async src="https://www.googletagmanager.com/gtag/js?id=UA-158512288-1"></script>
<script>
  window.dataLayer = window.dataLayer || [];
  function gtag(){dataLayer.push(arguments);}
  gtag('js', new Date());

  gtag('config', 'UA-158512288-1');
</script>


  </head>

  <body data-spy="scroll" data-target="#toc">
    <div class="container template-reference-topic">
      <header>
      <div class="navbar navbar-default navbar-fixed-top" role="navigation">
  <div class="container">
    <div class="navbar-header">
      <button type="button" class="navbar-toggle collapsed" data-toggle="collapse" data-target="#navbar" aria-expanded="false">
        <span class="sr-only">Toggle navigation</span>
        <span class="icon-bar"></span>
        <span class="icon-bar"></span>
        <span class="icon-bar"></span>
      </button>
      <span class="navbar-brand">
        <a class="navbar-link" href="../index.html">dymiumCore</a>
        <span class="version label label-default" data-toggle="tooltip" data-placement="bottom" title="Released version">0.1.9</span>
      </span>
    </div>

    <div id="navbar" class="navbar-collapse collapse">
      <ul class="nav navbar-nav">
        <li>
  <a href="../index.html">
    <span class="fas fa fas fa-home fa-lg"></span>
     
  </a>
</li>
<li>
  <a href="../articles/dymium-intro.html">Introduction</a>
</li>
<li>
  <a href="../reference/index.html">Reference</a>
</li>
<li class="dropdown">
  <a href="#" class="dropdown-toggle" data-toggle="dropdown" role="button" aria-expanded="false">
    Articles
     
    <span class="caret"></span>
  </a>
  <ul class="dropdown-menu" role="menu">
    <li>
      <a href="../articles/why-another-microsim.html">Why another microsimulation package?</a>
    </li>
    <li class="dropdown-header">Manual</li>
    <li>
      <a href="../articles/for-developers.html">For developers</a>
    </li>
    <li>
      <a href="../articles/for-modellers.html">For modellers</a>
    </li>
    <li>
      <a href="../articles/for-endusers.html">For end users</a>
    </li>
    <li class="dropdown-header">Use cases</li>
    <li>
      <a href="../articles/residential-mobility.html">Residential mobility</a>
    </li>
    <li>
      <a href="../articles/mate-matching.html">Mate matching</a>
    </li>
    <li>
      <a href="../articles/marital-status.html">Marital status</a>
    </li>
  </ul>
</li>
<li>
  <a href="../news/index.html">News</a>
</li>
      </ul>
      <ul class="nav navbar-nav navbar-right">
        <li>
  <a href="https://github.com/dymium-org/dymiumCore/">
    <span class="fab fa fab fa-github fa-lg"></span>
     
  </a>
</li>
      </ul>
      
      <form class="navbar-form navbar-right hidden-xs hidden-sm" role="search">
        <div class="form-group">
          <input type="search" class="form-control" name="search-input" id="search-input" placeholder="Search..." aria-label="Search for..." autocomplete="off">
        </div>
      </form>
      
    </div><!--/.nav-collapse -->
  </div><!--/.container -->
</div><!--/.navbar -->

      

      </header>

<div class="row">
  <div class="col-md-9 contents">
    <div class="page-header">
    <h1>Simulate state transition (Markov chain)</h1>
    <small class="dont-index">Source: <a href='https://github.com/dymium-org/dymiumCore/blob/master/R/transition-fnc.R'><code>R/transition-fnc.R</code></a></small>
    <div class="hidden name"><code>transition.Rd</code></div>
    </div>

    <div class="ref-description">
    <p>The <code>transition</code> function can be used to evaluate a model againts the attribute
data of an <a href='Entity.html'>Entity</a> object stored inside the input <a href='World.html'>World</a> object and update
an attribute of that <a href='Entity.html'>Entity</a> using random draws from the prediction result.
It allows simple state transitions to be simulated directly inside a
microsimulation pipeline, as it always returns the input <code>World</code> object.</p>
    </div>

    <pre class="usage"><span class='fu'>transition</span>(
  <span class='no'>world</span>,
  <span class='no'>entity</span>,
  <span class='no'>model</span>,
  <span class='kw'>target</span> <span class='kw'>=</span> <span class='kw'>NULL</span>,
  <span class='kw'>targeted_ids</span> <span class='kw'>=</span> <span class='kw'>NULL</span>,
  <span class='kw'>preprocessing_fn</span> <span class='kw'>=</span> <span class='kw'>NULL</span>,
  <span class='kw'>attr</span> <span class='kw'>=</span> <span class='kw'>NULL</span>,
  <span class='kw'>values</span> <span class='kw'>=</span> <span class='kw'>NULL</span>,
  <span class='kw'>verbose</span> <span class='kw'>=</span> <span class='fl'>FALSE</span>
)

<span class='fu'>get_transition</span>(
  <span class='no'>world</span>,
  <span class='no'>entity</span>,
  <span class='no'>model</span>,
  <span class='kw'>target</span> <span class='kw'>=</span> <span class='kw'>NULL</span>,
  <span class='kw'>targeted_ids</span> <span class='kw'>=</span> <span class='kw'>NULL</span>,
  <span class='kw'>preprocessing_fn</span> <span class='kw'>=</span> <span class='kw'>NULL</span>
)</pre>

    <h2 class="hasAnchor" id="arguments"><a class="anchor" href="#arguments"></a>Arguments</h2>
    <table class="ref-arguments">
    <colgroup><col class="name" /><col class="desc" /></colgroup>
    <tr>
      <th>world</th>
      <td><p>a <a href='World.html'>World</a> object</p></td>
    </tr>
    <tr>
      <th>entity</th>
      <td><p>a character indicating the entity class to apply the transition to.</p></td>
    </tr>
    <tr>
      <th>model</th>
      <td><p>a <a href='Model.html'>Model</a> object or an object in <code><a href='SupportedTransitionModels.html'>SupportedTransitionModels()</a></code>.</p></td>
    </tr>
    <tr>
      <th>target</th>
      <td><p>a <a href='Target.html'>Target</a> object or a named list or <code>NULL</code>.</p></td>
    </tr>
    <tr>
      <th>targeted_ids</th>
      <td><p>a integer vector containing ids of entities in <code>entity</code>
to undergo the transition or <code>NULL</code>.</p></td>
    </tr>
    <tr>
      <th>preprocessing_fn</th>
      <td><p>a function that accepts one argument or <code>NULL</code>. This allows preprocessing of
<code>entity</code>'s attribute data, for example, if only records with certain conditions
should undergo the transition or a new variable should be added to the data. See
the Note section below for how to create a preprocessing function.</p></td>
    </tr>
    <tr>
      <th>attr</th>
      <td><p>a character denoting which of the attribute if <code>entity</code> should be
updated as the result of the transition or <code>NULL</code>.</p></td>
    </tr>
    <tr>
      <th>values</th>
      <td><p>named <code><a href='https://rdrr.io/r/base/vector.html'>vector()</a></code><br />
A named vector that is used to replace the outcomes of the model in the field
specified in <code>attr</code>. See the example section.</p></td>
    </tr>
    <tr>
      <th>verbose</th>
      <td><p><code><a href='https://rdrr.io/r/base/logical.html'>logical()</a></code><br />
Default as <code>FALSE</code>.</p></td>
    </tr>
    </table>

    <h2 class="hasAnchor" id="value"><a class="anchor" href="#value"></a>Value</h2>

    <p>transition returns the first argument which is the <a href='World.html'>World</a> object, while
get_transition a data.table objec that contains the transition outcomes with
two columns: id and response.</p>
    <h2 class="hasAnchor" id="note"><a class="anchor" href="#note"></a>Note</h2>

    <p>In general, dymiumCore detects variables in entity data of an <a href='Entity.html'>Entity</a> object that
has a dot prefix as derived variables. Meaning, those derived variables are not
check against new entity data that are getting added to the <a href='Entity.html'>Entity</a> object. But
when entity data are used in <code>get_transition</code>, the dot prefix of the derived variables
will be removed. This is to make it convenient when naming variables during
the model estimation step.</p>
<p>To create a pre-processing function you can use <code>dplyr</code> or <code>data.table</code>. You can
even combine multiple functions with <code>magrittr::%&gt;%</code>. As an example, if you only
want to filter just the male population then you can choose one of the
following options to create your preprocessing function.</p><pre># as a function using base R
filter_male &amp;lt;- function(.data) {
  .data[.data$sex == "male"]
}

# dplyr's way
filter_male &amp;lt;- function(.data) {
  dplyr::filter(.data, sex == "male")
}

# data.table's way
filter_male &amp;lt;- function(.data) {
  .data[sex == "male", ]
}

# magrittr's way + dplyr's way
filter_male &amp;lt;-
  . %&amp;gt;%
  dplyr::filter(., sex == "male")

# magrittr's way + data.table's way + additional conditions
filter_male &amp;lt;-
  . %&amp;gt;%
  .[sex == "male", ] %&amp;gt;%
  .[age &amp;gt;= 50, ]

</pre>

<p>New variables can also be added to the entity data to be used in predicting
their transition probability. Again we can use <code>dplyr</code>'s or <code>data.table</code>'s way.
The examples below show how you can add a 5-year age group variable, called <code>age5</code>,
to the entity data.</p><pre># magrittr's way + data.table's way
filter_male &amp;lt;-
  . %&amp;gt;%
  .[sex == "male" &amp;amp; age &amp;gt;= 50, ] %&amp;gt;%
  .[, age5 := cut(age, breaks = c(seq(0,80,5), Inf), include.lowest = TRUE, right = FALSE)]

# magrittr's way + dplyr's way
filter_male &amp;lt;-
  . %&amp;gt;%
  dplyr::filter(., sex == "male" &amp;amp; age &amp;gt;= 50) %&amp;gt;%
  dplyr::mutate(., age5 = cut(age, breaks = c(seq(0,80,5), Inf), include.lowest = TRUE, right = FALSE))
</pre>

<p>Note that, new variables added inside preprocessing_fn won't
change the attribute data of the <code>entity</code> object that is undergoing a transition.
These variables only appear temporary within the context of the transition.</p>

    <h2 class="hasAnchor" id="examples"><a class="anchor" href="#examples"></a>Examples</h2>
    <pre class="examples"><div class='input'>
<span class='co'># create a filter function</span>
<span class='fu'><a href='https://rdrr.io/r/base/library.html'>library</a></span>(<span class='no'>caret</span>)</div><div class='output co'>#&gt; <span class='message'>Loading required package: lattice</span></div><div class='output co'>#&gt; <span class='message'>Loading required package: ggplot2</span></div><div class='input'>
<span class='no'>filter_male</span> <span class='kw'>&lt;-</span>
  <span class='no'>.</span> <span class='kw'>%&gt;%</span>
  <span class='no'>.</span>[<span class='no'>sex</span> <span class='kw'>==</span> <span class='st'>"male"</span>, ]

<span class='no'>filter_not_dead</span> <span class='kw'>&lt;-</span>
  <span class='no'>.</span> <span class='kw'>%&gt;%</span>
  <span class='no'>.</span>[<span class='no'>age</span> <span class='kw'>!=</span> -<span class='fl'>1</span>]

<span class='co'># create a multinomial logit model using `caret`</span>
<span class='no'>mnl</span> <span class='kw'>&lt;-</span> <span class='kw pkg'>caret</span><span class='kw ns'>::</span><span class='fu'><a href='https://rdrr.io/pkg/caret/man/train.html'>train</a></span>(<span class='no'>marital_status</span> ~ <span class='no'>age</span> + <span class='no'>sex</span>,
                    <span class='kw'>data</span> <span class='kw'>=</span> <span class='no'>toy_individuals</span>,
                    <span class='kw'>method</span> <span class='kw'>=</span> <span class='st'>"multinom"</span>,
                    <span class='kw'>trace</span> <span class='kw'>=</span> <span class='fl'>FALSE</span>)
<span class='co'># this model denotes that there is a 10% chance that an individual will decease</span>
<span class='no'>death_model</span> <span class='kw'>&lt;-</span> <span class='fu'><a href='https://rdrr.io/r/base/list.html'>list</a></span>(<span class='kw'>yes</span> <span class='kw'>=</span> <span class='fl'>0.1</span>, <span class='kw'>no</span> <span class='kw'>=</span> <span class='fl'>0.9</span>)

<span class='co'># create a toy world</span>
<span class='fu'><a href='create_toy_world.html'>create_toy_world</a></span>()</div><div class='output co'>#&gt; [04:20:00] WARN  dymiumCore .subset2(public_bind_env, "initialize"): Creating a `hhsize` column in `hh_data` as it is not provided.</div><div class='input'>
<span class='co'># simulate marital status transition and update the attribute.</span>
<span class='fu'>transition</span>(<span class='no'>world</span>,
           <span class='kw'>entity</span> <span class='kw'>=</span> <span class='st'>"Individual"</span>,
           <span class='kw'>model</span> <span class='kw'>=</span> <span class='no'>mnl</span>,
           <span class='kw'>preprocessing_fn</span> <span class='kw'>=</span> <span class='no'>filter_male</span>,
           <span class='kw'>attr</span> <span class='kw'>=</span> <span class='st'>"marital_status"</span>)

<span class='co'># get a transition result</span>
<span class='fu'>get_transition</span>(<span class='no'>world</span>,
               <span class='kw'>entity</span> <span class='kw'>=</span> <span class='st'>"Individual"</span>,
               <span class='kw'>model</span> <span class='kw'>=</span> <span class='no'>mnl</span>,
               <span class='kw'>preprocessing_fn</span> <span class='kw'>=</span> <span class='no'>filter_male</span>)</div><div class='output co'>#&gt;       id       response
#&gt;   1:   1        married
#&gt;   2:   4  never married
#&gt;   3:   6 not applicable
#&gt;   4:   7        married
#&gt;   5:  11  never married
#&gt;  ---                   
#&gt; 187: 367        married
#&gt; 188: 369        married
#&gt; 189: 371        married
#&gt; 190: 372  never married
#&gt; 191: 373  never married</div><div class='input'>
<span class='co'># lets make a pipeline of transitions</span>
<span class='no'>world</span> <span class='kw'>%&gt;%</span>
  <span class='fu'>transition</span>(<span class='kw'>entity</span> <span class='kw'>=</span> <span class='st'>"Individual"</span>,
             <span class='kw'>model</span> <span class='kw'>=</span> <span class='no'>mnl</span>,
             <span class='kw'>preprocessing_fn</span> <span class='kw'>=</span> <span class='no'>.</span> <span class='kw'>%&gt;%</span> <span class='no'>filter_male</span> <span class='kw'>%&gt;%</span> <span class='no'>filter_not_dead</span>,
             <span class='kw'>attr</span> <span class='kw'>=</span> <span class='st'>"marital_status"</span>) <span class='kw'>%&gt;%</span>
  <span class='fu'>transition</span>(<span class='kw'>entity</span> <span class='kw'>=</span> <span class='st'>"Individual"</span>,
             <span class='kw'>model</span> <span class='kw'>=</span> <span class='no'>death_model</span>,
             <span class='kw'>preprocessing_fn</span> <span class='kw'>=</span> <span class='no'>filter_not_dead</span>,
             <span class='kw'>attr</span> <span class='kw'>=</span> <span class='st'>"age"</span>,
             <span class='kw'>values</span> <span class='kw'>=</span> <span class='fu'><a href='https://rdrr.io/r/base/c.html'>c</a></span>(<span class='kw'>yes</span> <span class='kw'>=</span> -<span class='fl'>1L</span>))
<span class='co'># print the attributes of the individual agents</span>
<span class='no'>world</span>$<span class='no'>entities</span>$<span class='no'>Individual</span>$<span class='fu'>get_data</span>()</div><div class='output co'>#&gt;      pid hid age    sex marital_status partner_id father_id mother_id
#&gt;   1:   1   1  71   male        married         NA        NA        NA
#&gt;   2:   2   2  31 female  never married         NA        NA        NA
#&gt;   3:   3   2  29 female  never married         NA        NA        NA
#&gt;   4:   4   3  38   male  never married          5        NA        NA
#&gt;   5:   5   3  25 female        married          4        NA        NA
#&gt;  ---                                                                 
#&gt; 369: 369 143  -1   male      separated        368        NA        NA
#&gt; 370: 370 144  49 female        married        371        NA        NA
#&gt; 371: 371 144  59   male        married        370        NA        NA
#&gt; 372: 372 144  15   male  never married         NA       371       370
#&gt; 373: 373 144  17   male  never married         NA       371       370</div></pre>
  </div>
  <div class="col-md-3 hidden-xs hidden-sm" id="pkgdown-sidebar">
    <nav id="toc" data-toggle="toc" class="sticky-top">
      <h2 data-toc-skip>Contents</h2>
    </nav>
  </div>
</div>


      <footer>
      <div class="copyright">
  <p>Developed by Amarin Siripanich, Taha Rashidi.</p>
</div>

<div class="pkgdown">
  <p>Site built with <a href="https://pkgdown.r-lib.org/">pkgdown</a> 1.5.1.</p>
</div>

      </footer>
   </div>

  
<script src="https://cdnjs.cloudflare.com/ajax/libs/docsearch.js/2.6.1/docsearch.min.js" integrity="sha256-GKvGqXDznoRYHCwKXGnuchvKSwmx9SRMrZOTh2g4Sb0=" crossorigin="anonymous"></script>
<script>
  docsearch({
    
    
    apiKey: '5b9cd61032daf2c5966b7cd693157aa2',
    indexName: 'dymiumcore',
    inputSelector: 'input#search-input.form-control',
    transformData: function(hits) {
      return hits.map(function (hit) {
        hit.url = updateHitURL(hit);
        return hit;
      });
    }
  });
</script>



  </body>
</html>


