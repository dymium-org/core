<!DOCTYPE html>
<!-- Generated by pkgdown: do not edit by hand --><html lang="en">
<head>
<meta http-equiv="Content-Type" content="text/html; charset=UTF-8">
<meta charset="utf-8">
<meta http-equiv="X-UA-Compatible" content="IE=edge">
<meta name="viewport" content="width=device-width, initial-scale=1.0">
<title>Mate matching • dymiumCore</title>
<!-- favicons --><link rel="icon" type="image/png" sizes="16x16" href="../favicon-16x16.png">
<link rel="icon" type="image/png" sizes="32x32" href="../favicon-32x32.png">
<link rel="apple-touch-icon" type="image/png" sizes="180x180" href="../apple-touch-icon.png">
<link rel="apple-touch-icon" type="image/png" sizes="120x120" href="../apple-touch-icon-120x120.png">
<link rel="apple-touch-icon" type="image/png" sizes="76x76" href="../apple-touch-icon-76x76.png">
<link rel="apple-touch-icon" type="image/png" sizes="60x60" href="../apple-touch-icon-60x60.png">
<!-- jquery --><script src="https://cdnjs.cloudflare.com/ajax/libs/jquery/3.4.1/jquery.min.js" integrity="sha256-CSXorXvZcTkaix6Yvo6HppcZGetbYMGWSFlBw8HfCJo=" crossorigin="anonymous"></script><!-- Bootstrap --><link href="https://cdnjs.cloudflare.com/ajax/libs/bootswatch/3.4.0/readable/bootstrap.min.css" rel="stylesheet" crossorigin="anonymous">
<script src="https://cdnjs.cloudflare.com/ajax/libs/twitter-bootstrap/3.4.1/js/bootstrap.min.js" integrity="sha256-nuL8/2cJ5NDSSwnKD8VqreErSWHtnEP9E7AySL+1ev4=" crossorigin="anonymous"></script><!-- bootstrap-toc --><link rel="stylesheet" href="../bootstrap-toc.css">
<script src="../bootstrap-toc.js"></script><!-- Font Awesome icons --><link rel="stylesheet" href="https://cdnjs.cloudflare.com/ajax/libs/font-awesome/5.12.1/css/all.min.css" integrity="sha256-mmgLkCYLUQbXn0B1SRqzHar6dCnv9oZFPEC1g1cwlkk=" crossorigin="anonymous">
<link rel="stylesheet" href="https://cdnjs.cloudflare.com/ajax/libs/font-awesome/5.12.1/css/v4-shims.min.css" integrity="sha256-wZjR52fzng1pJHwx4aV2AO3yyTOXrcDW7jBpJtTwVxw=" crossorigin="anonymous">
<!-- clipboard.js --><script src="https://cdnjs.cloudflare.com/ajax/libs/clipboard.js/2.0.6/clipboard.min.js" integrity="sha256-inc5kl9MA1hkeYUt+EC3BhlIgyp/2jDIyBLS6k3UxPI=" crossorigin="anonymous"></script><!-- headroom.js --><script src="https://cdnjs.cloudflare.com/ajax/libs/headroom/0.11.0/headroom.min.js" integrity="sha256-AsUX4SJE1+yuDu5+mAVzJbuYNPHj/WroHuZ8Ir/CkE0=" crossorigin="anonymous"></script><script src="https://cdnjs.cloudflare.com/ajax/libs/headroom/0.11.0/jQuery.headroom.min.js" integrity="sha256-ZX/yNShbjqsohH1k95liqY9Gd8uOiE1S4vZc+9KQ1K4=" crossorigin="anonymous"></script><!-- pkgdown --><link href="../pkgdown.css" rel="stylesheet">
<script src="../pkgdown.js"></script><!-- docsearch --><script src="../docsearch.js"></script><link rel="stylesheet" href="https://cdnjs.cloudflare.com/ajax/libs/docsearch.js/2.6.3/docsearch.min.css" integrity="sha256-QOSRU/ra9ActyXkIBbiIB144aDBdtvXBcNc3OTNuX/Q=" crossorigin="anonymous">
<link href="../docsearch.css" rel="stylesheet">
<script src="https://cdnjs.cloudflare.com/ajax/libs/mark.js/8.11.1/jquery.mark.min.js" integrity="sha256-4HLtjeVgH0eIB3aZ9mLYF6E8oU5chNdjU6p6rrXpl9U=" crossorigin="anonymous"></script><meta property="og:title" content="Mate matching">
<meta property="og:description" content="dymiumCore">
<meta property="og:image" content="https://core.dymium.org/logo.png">
<!-- mathjax --><script src="https://cdnjs.cloudflare.com/ajax/libs/mathjax/2.7.5/MathJax.js" integrity="sha256-nvJJv9wWKEm88qvoQl9ekL2J+k/RWIsaSScxxlsrv8k=" crossorigin="anonymous"></script><script src="https://cdnjs.cloudflare.com/ajax/libs/mathjax/2.7.5/config/TeX-AMS-MML_HTMLorMML.js" integrity="sha256-84DKXVJXs0/F8OTMzX4UR909+jtl4G7SPypPavF+GfA=" crossorigin="anonymous"></script><!--[if lt IE 9]>
<script src="https://oss.maxcdn.com/html5shiv/3.7.3/html5shiv.min.js"></script>
<script src="https://oss.maxcdn.com/respond/1.4.2/respond.min.js"></script>
<![endif]--><!-- Global site tag (gtag.js) - Google Analytics --><script async src="https://www.googletagmanager.com/gtag/js?id=UA-158512288-1"></script><script>
  window.dataLayer = window.dataLayer || [];
  function gtag(){dataLayer.push(arguments);}
  gtag('js', new Date());

  gtag('config', 'UA-158512288-1');
</script>
</head>
<body data-spy="scroll" data-target="#toc">
    <div class="container template-article">
      <header><div class="navbar navbar-default navbar-fixed-top" role="navigation">
  <div class="container">
    <div class="navbar-header">
      <button type="button" class="navbar-toggle collapsed" data-toggle="collapse" data-target="#navbar" aria-expanded="false">
        <span class="sr-only">Toggle navigation</span>
        <span class="icon-bar"></span>
        <span class="icon-bar"></span>
        <span class="icon-bar"></span>
      </button>
      <span class="navbar-brand">
        <a class="navbar-link" href="../index.html">dymiumCore</a>
        <span class="version label label-default" data-toggle="tooltip" data-placement="bottom" title="Released version">0.1.9</span>
      </span>
    </div>

    <div id="navbar" class="navbar-collapse collapse">
      <ul class="nav navbar-nav">
<li>
  <a href="../index.html">
    <span class="fas fa fas fa-home fa-lg"></span>
     
  </a>
</li>
<li>
  <a href="../articles/dymium-intro.html">Introduction</a>
</li>
<li>
  <a href="../reference/index.html">Reference</a>
</li>
<li class="dropdown">
  <a href="#" class="dropdown-toggle" data-toggle="dropdown" role="button" aria-expanded="false">
    Articles
     
    <span class="caret"></span>
  </a>
  <ul class="dropdown-menu" role="menu">
<li>
      <a href="../articles/why-another-microsim.html">Why another microsimulation package?</a>
    </li>
    <li class="dropdown-header">Manual</li>
    <li>
      <a href="../articles/for-developers.html">For developers</a>
    </li>
    <li>
      <a href="../articles/for-modellers.html">For modellers</a>
    </li>
    <li>
      <a href="../articles/for-endusers.html">For end users</a>
    </li>
    <li class="dropdown-header">Use cases</li>
    <li>
      <a href="../articles/residential-mobility.html">Residential mobility</a>
    </li>
    <li>
      <a href="../articles/mate-matching.html">Mate matching</a>
    </li>
    <li>
      <a href="../articles/marital-status.html">Marital status</a>
    </li>
  </ul>
</li>
<li>
  <a href="../news/index.html">News</a>
</li>
      </ul>
<ul class="nav navbar-nav navbar-right">
<li>
  <a href="https://github.com/dymium-org/dymiumCore/">
    <span class="fab fa fab fa-github fa-lg"></span>
     
  </a>
</li>
      </ul>
<form class="navbar-form navbar-right hidden-xs hidden-sm" role="search">
        <div class="form-group">
          <input type="search" class="form-control" name="search-input" id="search-input" placeholder="Search..." aria-label="Search for..." autocomplete="off">
</div>
      </form>
      
    </div>
<!--/.nav-collapse -->
  </div>
<!--/.container -->
</div>
<!--/.navbar -->

      

      </header><script src="mate-matching_files/accessible-code-block-0.0.1/empty-anchor.js"></script><div class="row">
  <div class="col-md-9 contents">
    <div class="page-header toc-ignore">
      <h1 data-toc-skip>Mate matching</h1>
            
      
      <small class="dont-index">Source: <a href="https://github.com/dymium-org/dymiumCore/blob/master/vignettes/mate-matching.Rmd"><code>vignettes/mate-matching.Rmd</code></a></small>
      <div class="hidden name"><code>mate-matching.Rmd</code></div>

    </div>

    
    
<div class="sourceCode" id="cb1"><html><body><pre class="r"><span class="co"># To install a package use `install.packages('package-name')`</span>
<span class="fu"><a href="https://rdrr.io/r/base/library.html">library</a></span>(<span class="no">dymiumCore</span>)
<span class="co">#&gt; ── * dymium's options * ──────────────────────────────────────────────────────</span>
<span class="co">#&gt; ● dymium.input_dir:</span>
<span class="co">#&gt;   /var/folders/24/8k48jl6d249_n_qfxwsl6xvm0000gn/T//RtmplIVPca/scenario/inputs</span>
<span class="co">#&gt; ● dymium.output_dir:</span>
<span class="co">#&gt;   /var/folders/24/8k48jl6d249_n_qfxwsl6xvm0000gn/T//RtmplIVPca/scenario/outputs</span>
<span class="co">#&gt; ● dymium.scenario_dir:</span>
<span class="co">#&gt;   /var/folders/24/8k48jl6d249_n_qfxwsl6xvm0000gn/T//RtmplIVPca/scenario</span>
<span class="co">#&gt; ● dymium.simulation_clock: 0</span>
<span class="co">#&gt; ● dymium.simulation_scale: 1</span>
<span class="fu"><a href="https://rdrr.io/r/base/library.html">library</a></span>(<span class="no">data.table</span>)
<span class="fu"><a href="https://rdrr.io/r/base/library.html">library</a></span>(<span class="no">R6</span>)
<span class="fu"><a href="https://rdrr.io/r/base/library.html">library</a></span>(<span class="no">dplyr</span>)
<span class="co">#&gt; </span>
<span class="co">#&gt; Attaching package: 'dplyr'</span>
<span class="co">#&gt; The following objects are masked from 'package:data.table':</span>
<span class="co">#&gt; </span>
<span class="co">#&gt;     between, first, last</span>
<span class="co">#&gt; The following objects are masked from 'package:stats':</span>
<span class="co">#&gt; </span>
<span class="co">#&gt;     filter, lag</span>
<span class="co">#&gt; The following objects are masked from 'package:base':</span>
<span class="co">#&gt; </span>
<span class="co">#&gt;     intersect, setdiff, setequal, union</span>
<span class="fu"><a href="https://rdrr.io/r/base/library.html">library</a></span>(<span class="no">ggplot2</span>)
<span class="fu"><a href="https://rdrr.io/r/base/library.html">library</a></span>(<span class="no">patchwork</span>)
<span class="fu"><a href="https://rdrr.io/r/base/Random.html">set.seed</a></span>(<span class="fl">728</span>)
<span class="kw pkg">knitr</span><span class="kw ns">::</span><span class="no"><a href="https://rdrr.io/pkg/knitr/man/opts_chunk.html">opts_chunk</a></span>$<span class="fu"><a href="https://Rdatatable.gitlab.io/data.table/reference/assign.html">set</a></span>(<span class="kw">echo</span> <span class="kw">=</span> <span class="fl">TRUE</span>)</pre></body></html></div>
<div id="load-population" class="section level2">
<h2 class="hasAnchor">
<a href="#load-population" class="anchor"></a>Load population</h2>
<div class="sourceCode" id="cb2"><html><body><pre class="r"><span class="co"># Import individual and household data</span>
<span class="no">ind_data</span> <span class="kw">&lt;-</span> <span class="no">toy_individuals</span>

<span class="co"># Create an Individual object with attribute data</span>
<span class="no">Ind</span> <span class="kw">&lt;-</span> <span class="no">Individual</span>$<span class="fu">new</span>(<span class="kw">.data</span> <span class="kw">=</span> <span class="no">ind_data</span>, <span class="kw">id_col</span> <span class="kw">=</span> <span class="st">"pid"</span>)

<span class="co"># show data</span>
<span class="no">Ind</span>$<span class="fu">get_data</span>()
<span class="co">#&gt;      pid hid age    sex marital_status partner_id father_id mother_id</span>
<span class="co">#&gt;   1:   1   1  71   male  never married         NA        NA        NA</span>
<span class="co">#&gt;   2:   2   2  31 female  never married         NA        NA        NA</span>
<span class="co">#&gt;   3:   3   2  29 female  never married         NA        NA        NA</span>
<span class="co">#&gt;   4:   4   3  38   male        married          5        NA        NA</span>
<span class="co">#&gt;   5:   5   3  25 female        married          4        NA        NA</span>
<span class="co">#&gt;  ---                                                                 </span>
<span class="co">#&gt; 369: 369 143  73   male        married        368        NA        NA</span>
<span class="co">#&gt; 370: 370 144  49 female        married        371        NA        NA</span>
<span class="co">#&gt; 371: 371 144  59   male        married        370        NA        NA</span>
<span class="co">#&gt; 372: 372 144  15   male  never married         NA       371       370</span>
<span class="co">#&gt; 373: 373 144  17   male  never married         NA       371       370</span></pre></body></html></div>
</div>
<div id="randomly-assign-group-to-agents" class="section level2">
<h2 class="hasAnchor">
<a href="#randomly-assign-group-to-agents" class="anchor"></a>Randomly assign group to agents</h2>
<p>All agents will be randomly assigned a group number to them this is to create sub markets. Sub markets are defined such that only agents within the same sub market can interact with each other. This maybe used to mimic agents’ social network, geographical boundary, etc.</p>
<div class="sourceCode" id="cb3"><html><body><pre class="r"><span class="no">n_groups</span> <span class="kw">&lt;-</span> <span class="fl">2</span>

<span class="co"># randomly assign group numbers to all agents</span>
<span class="no">Ind</span>$<span class="fu">get_data</span>(<span class="kw">copy</span> <span class="kw">=</span> <span class="fl">FALSE</span>)[, <span class="no">group</span> <span class="kw">:=</span> <span class="fu"><a href="https://rdrr.io/r/base/sample.html">sample</a></span>(<span class="fu"><a href="https://rdrr.io/r/base/paste.html">paste0</a></span>(<span class="st">"Group_"</span>, <span class="fl">1</span>:<span class="no">n_groups</span>), <span class="kw">size</span> <span class="kw">=</span> <span class="no">.N</span>, <span class="kw">replace</span> <span class="kw">=</span> <span class="fl">TRUE</span>)]</pre></body></html></div>
<div class="sourceCode" id="cb4"><html><body><pre class="r"><span class="no">Ind</span>$<span class="fu">get_data</span>() <span class="kw">%&gt;%</span>
  <span class="fu"><a href="https://ggplot2.tidyverse.org/reference/ggplot.html">ggplot</a></span>(<span class="kw">data</span> <span class="kw">=</span> <span class="no">.</span>, <span class="fu"><a href="https://ggplot2.tidyverse.org/reference/aes.html">aes</a></span>(<span class="kw">x</span> <span class="kw">=</span> <span class="no">age</span>, <span class="kw">fill</span> <span class="kw">=</span> <span class="no">sex</span>)) +
    <span class="fu"><a href="https://ggplot2.tidyverse.org/reference/geom_density.html">geom_density</a></span>() +
    <span class="fu"><a href="https://ggplot2.tidyverse.org/reference/facet_grid.html">facet_grid</a></span>(<span class="no">group</span> ~ <span class="no">sex</span>) +
    <span class="kw pkg">ggthemes</span><span class="kw ns">::</span><span class="fu"><a href="https://rdrr.io/pkg/ggthemes/man/scale_few.html">scale_fill_few</a></span>() +
    <span class="kw pkg">ggthemes</span><span class="kw ns">::</span><span class="fu"><a href="https://rdrr.io/pkg/ggthemes/man/theme_few.html">theme_few</a></span>(<span class="kw">base_size</span> <span class="kw">=</span> <span class="fl">12</span>) +
    <span class="fu"><a href="https://ggplot2.tidyverse.org/reference/labs.html">labs</a></span>(<span class="kw">title</span> <span class="kw">=</span> <span class="st">"Distribution of age by gender and group."</span>)</pre></body></html></div>
<p><img src="mate-matching_files/figure-html/unnamed-chunk-4-1.png" width="100%"></p>
</div>
<div id="implement-matching-markets" class="section level2">
<h2 class="hasAnchor">
<a href="#implement-matching-markets" class="anchor"></a>Implement matching markets</h2>
<p>New matching market can be extended from the available matching market classes which are <code>MatchingMarketStochastic</code> and <code>MatchingMarketOptimal</code>. In every matching problems there are two sides of the market, we call them A and B. Scoring functions need to be defined for each side of the market manually by implementing <code>matching_score_A</code> and <code>matching_score_B</code>. <code>matching_score_A</code> represent how agents in one side of the market evaluate the candidates of the opposite side, and vice versa for <code>matching_score_B</code>. The user is expected to change the function but the three main argument for both the scoring functions must remain the same. <code>self$matching_problem</code> allows the function to access the variables given when the class was created.</p>
<p>The rule that all agents follow is simple, they want to find a match that has the least age difference, as expressed in the scoring functions <code>matching_score_A</code> and <code>matching_score_B</code>.</p>
<p><span class="math display">\[ MatchingScore_x = \frac{1}{1+|age_x - age_y|}\]</span></p>
<div class="sourceCode" id="cb5"><html><body><pre class="r"><span class="fu"><a href="https://rdrr.io/r/base/library.html">require</a></span>(<span class="no">lattice</span>)
<span class="co">#&gt; Loading required package: lattice</span>
<span class="no">x</span> <span class="kw">&lt;-</span> <span class="fu"><a href="https://rdrr.io/r/base/seq.html">seq</a></span>(-<span class="fl">10</span>, <span class="fl">10</span>, <span class="kw">length.out</span> <span class="kw">=</span> <span class="fl">15</span>)
<span class="no">y</span> <span class="kw">&lt;-</span> <span class="no">x</span>
<span class="no">f</span> <span class="kw">&lt;-</span> <span class="kw">function</span>(<span class="no">x</span>,<span class="no">y</span>) {
  <span class="fl">1</span> / (<span class="fl">1</span> + <span class="fu"><a href="https://rdrr.io/r/base/MathFun.html">abs</a></span>(<span class="no">x</span>-<span class="no">y</span>))
}
<span class="no">z</span> <span class="kw">&lt;-</span> <span class="fu"><a href="https://rdrr.io/r/base/outer.html">outer</a></span>(<span class="no">x</span>, <span class="no">y</span>, <span class="no">f</span>)
<span class="fu"><a href="https://rdrr.io/pkg/lattice/man/cloud.html">wireframe</a></span>(<span class="no">z</span>, <span class="kw">drape</span><span class="kw">=</span><span class="no">T</span>, <span class="kw">col.regions</span><span class="kw">=</span><span class="fu"><a href="https://rdrr.io/r/grDevices/palettes.html">rainbow</a></span>(<span class="fl">100</span>), <span class="kw">zlab</span> <span class="kw">=</span> <span class="st">"Score"</span>, <span class="kw">xlab</span> <span class="kw">=</span> <span class="st">"age_x"</span>, <span class="kw">y</span> <span class="kw">=</span> <span class="st">"age_y"</span>)</pre></body></html></div>
<p><img src="mate-matching_files/figure-html/unnamed-chunk-5-1.png" width="100%"></p>
<div class="sourceCode" id="cb6"><html><body><pre class="r"><span class="no">MateMatchingStochastic</span> <span class="kw">&lt;-</span> <span class="kw pkg">R6</span><span class="kw ns">::</span><span class="fu"><a href="https://rdrr.io/pkg/R6/man/R6Class.html">R6Class</a></span>(
  <span class="kw">classname</span> <span class="kw">=</span> <span class="st">"StochasticCohabitationMarket"</span>,
  <span class="kw">inherit</span> <span class="kw">=</span> <span class="no">MatchingMarketStochastic</span>,
  <span class="kw">public</span> <span class="kw">=</span> <span class="fu"><a href="https://rdrr.io/r/base/list.html">list</a></span>(
    <span class="kw">matching_score_A</span> <span class="kw">=</span> <span class="kw">function</span>(<span class="no">matching_problem</span> <span class="kw">=</span> <span class="no">self</span>$<span class="no">matching_problem</span>,
                                <span class="no">idx_A</span>,
                                <span class="no">idx_B</span>) {
      <span class="no">scores</span> <span class="kw">&lt;-</span> <span class="fl">1</span> / (<span class="fl">1</span> + <span class="fu"><a href="https://rdrr.io/r/base/MathFun.html">abs</a></span>(
        <span class="no">matching_problem</span>$<span class="no">agentset_A</span><span class="kw">[[</span><span class="st">"age"</span>]][<span class="no">idx_A</span>] -
          <span class="no">matching_problem</span>$<span class="no">agentset_B</span><span class="kw">[[</span><span class="st">"age"</span>]][<span class="no">idx_B</span>]
      ))
    },
    <span class="kw">matching_score_B</span> <span class="kw">=</span> <span class="kw">function</span>(<span class="no">matching_problem</span> <span class="kw">=</span> <span class="no">self</span>$<span class="no">matching_problem</span>,
                                <span class="no">idx_B</span>,
                                <span class="no">idx_A</span>) {
      <span class="no">scores</span> <span class="kw">&lt;-</span> <span class="fl">1</span> / (<span class="fl">1</span> + <span class="fu"><a href="https://rdrr.io/r/base/MathFun.html">abs</a></span>(
        <span class="no">matching_problem</span>$<span class="no">agentset_B</span><span class="kw">[[</span><span class="st">"age"</span>]][<span class="no">idx_B</span>] -
          <span class="no">matching_problem</span>$<span class="no">agentset_A</span><span class="kw">[[</span><span class="st">"age"</span>]][<span class="no">idx_A</span>]
      ))
    }
  )
)</pre></body></html></div>
<div class="sourceCode" id="cb7"><html><body><pre class="r"><span class="no">MateMatchingOptimal</span> <span class="kw">&lt;-</span> <span class="kw pkg">R6</span><span class="kw ns">::</span><span class="fu"><a href="https://rdrr.io/pkg/R6/man/R6Class.html">R6Class</a></span>(
  <span class="kw">classname</span> <span class="kw">=</span> <span class="st">"MateMatchingOptimal"</span>,
  <span class="kw">inherit</span> <span class="kw">=</span> <span class="no">MatchingMarketOptimal</span>,
  <span class="kw">public</span> <span class="kw">=</span> <span class="fu"><a href="https://rdrr.io/r/base/list.html">list</a></span>(
    <span class="kw">matching_score_A</span> <span class="kw">=</span> <span class="kw">function</span>(<span class="no">matching_problem</span> <span class="kw">=</span> <span class="no">self</span>$<span class="no">matching_problem</span>, <span class="no">idx_A</span>, <span class="no">idx_B</span>) {
      <span class="fu"><a href="https://rdrr.io/r/base/outer.html">outer</a></span>(<span class="kw">X</span> <span class="kw">=</span> <span class="no">matching_problem</span>$<span class="no">agentset_B</span><span class="kw">[[</span><span class="st">"age"</span>]][<span class="no">idx_B</span>], <span class="co"># reviewers, rows</span>
            <span class="kw">Y</span> <span class="kw">=</span> <span class="no">matching_problem</span>$<span class="no">agentset_A</span><span class="kw">[[</span><span class="st">"age"</span>]][<span class="no">idx_A</span>], <span class="co"># proposers, columns</span>
            <span class="kw">function</span>(<span class="no">x</span>, <span class="no">y</span>) {
              <span class="fl">1</span> / (<span class="fl">1</span> + <span class="fu"><a href="https://rdrr.io/r/base/MathFun.html">abs</a></span>(<span class="no">x</span> - <span class="no">y</span>))
            })
    },
    <span class="kw">matching_score_B</span> <span class="kw">=</span> <span class="kw">function</span>(<span class="no">matching_problem</span> <span class="kw">=</span> <span class="no">self</span>$<span class="no">matching_problem</span>, <span class="no">idx_B</span>, <span class="no">idx_A</span>) {
      <span class="fu"><a href="https://rdrr.io/r/base/outer.html">outer</a></span>(<span class="kw">X</span> <span class="kw">=</span> <span class="no">matching_problem</span>$<span class="no">agentset_A</span><span class="kw">[[</span><span class="st">"age"</span>]][<span class="no">idx_A</span>], <span class="co"># reviewers, rows</span>
            <span class="kw">Y</span> <span class="kw">=</span> <span class="no">matching_problem</span>$<span class="no">agentset_B</span><span class="kw">[[</span><span class="st">"age"</span>]][<span class="no">idx_B</span>], <span class="co"># proposers, columns</span>
            <span class="kw">function</span>(<span class="no">x</span>, <span class="no">y</span>) {
              <span class="fl">1</span> / (<span class="fl">1</span> + <span class="fu"><a href="https://rdrr.io/r/base/MathFun.html">abs</a></span>(<span class="no">x</span> - <span class="no">y</span>))
            })
    }
  )
)</pre></body></html></div>
</div>
<div id="simulation" class="section level2">
<h2 class="hasAnchor">
<a href="#simulation" class="anchor"></a>Simulation</h2>
<div class="sourceCode" id="cb8"><html><body><pre class="r"><span class="co"># using dplyr's filter</span>
<span class="no">agentset_A</span> <span class="kw">&lt;-</span> <span class="no">Ind</span>$<span class="fu">get_data</span>() <span class="kw">%&gt;%</span>
  <span class="kw pkg">dplyr</span><span class="kw ns">::</span><span class="fu"><a href="https://dplyr.tidyverse.org/reference/filter.html">filter</a></span>(<span class="no">age</span> <span class="kw">&gt;</span> <span class="fl">20</span> <span class="kw">&amp;</span> <span class="no">age</span> <span class="kw">&lt;</span> <span class="fl">60</span> <span class="kw">&amp;</span> <span class="no">sex</span> <span class="kw">==</span> <span class="st">'male'</span>) <span class="kw">%&gt;%</span>
  <span class="kw pkg">data.table</span><span class="kw ns">::</span><span class="fu"><a href="https://Rdatatable.gitlab.io/data.table/reference/setDT.html">setDT</a></span>(<span class="no">.</span>) <span class="co"># convert back to data.table</span>

<span class="co"># using data.table syntax for filtering</span>
<span class="no">agentset_B</span> <span class="kw">&lt;-</span> <span class="no">Ind</span>$<span class="fu">get_data</span>() <span class="kw">%&gt;%</span>
  <span class="no">.</span>[<span class="no">age</span> <span class="kw">%between%</span> <span class="fu"><a href="https://rdrr.io/r/base/c.html">c</a></span>(<span class="fl">20</span>, <span class="fl">60</span>) <span class="kw">&amp;</span> <span class="no">sex</span> <span class="kw">==</span> <span class="st">'female'</span>]

<span class="co"># define id column</span>
<span class="no">id_col_A</span> <span class="kw">&lt;-</span> <span class="no">id_col_B</span> <span class="kw">&lt;-</span> <span class="st">'pid'</span>

<span class="co"># create a market object using its constructor</span>
<span class="no">StochasticMatching</span> <span class="kw">&lt;-</span> <span class="no">MateMatchingStochastic</span>$<span class="fu">new</span>(<span class="no">agentset_A</span>, <span class="no">agentset_B</span>, <span class="no">id_col_A</span>, <span class="no">id_col_B</span>, <span class="kw">grouping_vars</span> <span class="kw">=</span> <span class="fu"><a href="https://rdrr.io/r/base/c.html">c</a></span>(<span class="st">'group'</span>))
<span class="co">#&gt; Loading required namespace: testthat</span>

<span class="no">OptimalMatching</span> <span class="kw">&lt;-</span> <span class="no">MateMatchingOptimal</span>$<span class="fu">new</span>(<span class="no">agentset_A</span>, <span class="no">agentset_B</span>, <span class="no">id_col_A</span>, <span class="no">id_col_B</span>, <span class="kw">grouping_vars</span> <span class="kw">=</span> <span class="fu"><a href="https://rdrr.io/r/base/c.html">c</a></span>(<span class="st">'group'</span>))</pre></body></html></div>
<div class="sourceCode" id="cb9"><html><body><pre class="r"><span class="no">stochastic_matching_result</span> <span class="kw">&lt;-</span>
  <span class="no">StochasticMatching</span>$<span class="fu"><a href="https://rdrr.io/r/stats/simulate.html">simulate</a></span>(<span class="kw">n_choices</span> <span class="kw">=</span> <span class="fl">10</span>, <span class="co"># number of potential partners each agent evaluates</span>
                              <span class="kw">method</span> <span class="kw">=</span> <span class="st">'pweighted'</span>, <span class="co"># weighted probability</span>
                              <span class="kw">by_group</span> <span class="kw">=</span> <span class="fl">TRUE</span>) <span class="co"># segments the whole population into by markets by their group</span>

<span class="no">optimal_matching_result</span> <span class="kw">&lt;-</span>
  <span class="no">OptimalMatching</span>$<span class="fu"><a href="https://rdrr.io/r/stats/simulate.html">simulate</a></span>(<span class="kw">method</span> <span class="kw">=</span> <span class="st">"one-to-one"</span>, <span class="co"># each agent only has one match.</span>
                           <span class="kw">one_sided</span> <span class="kw">=</span> <span class="fl">FALSE</span>, <span class="co"># agents from both sides of the market have preferences towards each other</span>
                           <span class="kw">optimal_A</span> <span class="kw">=</span> <span class="fl">TRUE</span>, <span class="co"># optimal for A</span>
                           <span class="kw">by_group</span> <span class="kw">=</span> <span class="fl">TRUE</span>) <span class="co"># segments the whole population into by markets by their group</span></pre></body></html></div>
</div>
<div id="visualise-the-match-qualities-of-the-two-approaches-" class="section level2">
<h2 class="hasAnchor">
<a href="#visualise-the-match-qualities-of-the-two-approaches-" class="anchor"></a>Visualise the match qualities of the two approaches.</h2>
<div class="sourceCode" id="cb10"><html><body><pre class="r"><span class="no">agediff_range</span> <span class="kw">&lt;-</span> <span class="fu"><a href="https://rdrr.io/r/base/c.html">c</a></span>(-<span class="fl">20</span>, <span class="fl">20</span>)

<span class="no">stochastic_matching_quality</span> <span class="kw">&lt;-</span>
  <span class="fu"><a href="https://Rdatatable.gitlab.io/data.table/reference/na.omit.data.table.html">na.omit</a></span>(<span class="no">stochastic_matching_result</span>) <span class="kw">%&gt;%</span>
  <span class="fu"><a href="https://Rdatatable.gitlab.io/data.table/reference/merge.html">merge</a></span>(<span class="kw">x</span> <span class="kw">=</span> <span class="no">.</span>, <span class="kw">y</span> <span class="kw">=</span> <span class="no">Ind</span>$<span class="fu">get_data</span>()[, <span class="fu">.</span>(<span class="no">pid</span>, <span class="no">age</span>)], <span class="kw">by.x</span> <span class="kw">=</span> <span class="st">'id_A'</span>, <span class="kw">by.y</span> <span class="kw">=</span> <span class="st">'pid'</span>) <span class="kw">%&gt;%</span>
  <span class="fu"><a href="https://Rdatatable.gitlab.io/data.table/reference/merge.html">merge</a></span>(<span class="kw">x</span> <span class="kw">=</span> <span class="no">.</span>, <span class="kw">y</span> <span class="kw">=</span> <span class="no">Ind</span>$<span class="fu">get_data</span>()[, <span class="fu">.</span>(<span class="no">pid</span>, <span class="no">age</span>)], <span class="kw">by.x</span> <span class="kw">=</span> <span class="st">'id_B'</span>, <span class="kw">by.y</span> <span class="kw">=</span> <span class="st">'pid'</span>, <span class="kw">suffixes</span> <span class="kw">=</span> <span class="fu"><a href="https://rdrr.io/r/base/c.html">c</a></span>(<span class="st">'_A'</span>, <span class="st">'_B'</span>)) <span class="kw">%&gt;%</span>
  <span class="no">.</span>[, <span class="no">age_diff</span> <span class="kw">:=</span> <span class="no">age_A</span> - <span class="no">age_B</span>]

<span class="no">p_1</span> <span class="kw">&lt;-</span> <span class="fu"><a href="https://ggplot2.tidyverse.org/reference/ggplot.html">ggplot</a></span>(<span class="kw">data</span> <span class="kw">=</span> <span class="no">stochastic_matching_quality</span>, <span class="fu"><a href="https://ggplot2.tidyverse.org/reference/aes.html">aes</a></span>(<span class="no">age_diff</span>)) +
  <span class="fu"><a href="https://ggplot2.tidyverse.org/reference/geom_density.html">geom_density</a></span>(<span class="kw">color</span> <span class="kw">=</span> <span class="st">"black"</span>, <span class="kw">fill</span> <span class="kw">=</span> <span class="st">"steelblue"</span>) +
  <span class="fu"><a href="https://ggplot2.tidyverse.org/reference/ggtheme.html">theme_bw</a></span>() +
  <span class="fu"><a href="https://ggplot2.tidyverse.org/reference/scale_continuous.html">scale_x_continuous</a></span>(<span class="kw">limits</span> <span class="kw">=</span> <span class="no">agediff_range</span>) +
  <span class="fu"><a href="https://ggplot2.tidyverse.org/reference/labs.html">labs</a></span>(<span class="kw">title</span> <span class="kw">=</span> <span class="st">"Stochastic market"</span>)

<span class="no">optimal_matching_quality</span> <span class="kw">&lt;-</span>
  <span class="fu"><a href="https://Rdatatable.gitlab.io/data.table/reference/na.omit.data.table.html">na.omit</a></span>(<span class="no">optimal_matching_result</span>) <span class="kw">%&gt;%</span>
  <span class="fu"><a href="https://Rdatatable.gitlab.io/data.table/reference/merge.html">merge</a></span>(<span class="kw">x</span> <span class="kw">=</span> <span class="no">.</span>, <span class="kw">y</span> <span class="kw">=</span> <span class="no">Ind</span>$<span class="fu">get_data</span>()[, <span class="fu">.</span>(<span class="no">pid</span>, <span class="no">age</span>)], <span class="kw">by.x</span> <span class="kw">=</span> <span class="st">'id_A'</span>, <span class="kw">by.y</span> <span class="kw">=</span> <span class="st">'pid'</span>) <span class="kw">%&gt;%</span>
  <span class="fu"><a href="https://Rdatatable.gitlab.io/data.table/reference/merge.html">merge</a></span>(<span class="kw">x</span> <span class="kw">=</span> <span class="no">.</span>, <span class="kw">y</span> <span class="kw">=</span> <span class="no">Ind</span>$<span class="fu">get_data</span>()[, <span class="fu">.</span>(<span class="no">pid</span>, <span class="no">age</span>)], <span class="kw">by.x</span> <span class="kw">=</span> <span class="st">'id_B'</span>, <span class="kw">by.y</span> <span class="kw">=</span> <span class="st">'pid'</span>, <span class="kw">suffixes</span> <span class="kw">=</span> <span class="fu"><a href="https://rdrr.io/r/base/c.html">c</a></span>(<span class="st">'_A'</span>, <span class="st">'_B'</span>)) <span class="kw">%&gt;%</span>
  <span class="no">.</span>[, <span class="no">age_diff</span> <span class="kw">:=</span> <span class="no">age_A</span> - <span class="no">age_B</span>]

<span class="no">p_2</span> <span class="kw">&lt;-</span> <span class="fu"><a href="https://ggplot2.tidyverse.org/reference/ggplot.html">ggplot</a></span>(<span class="kw">data</span> <span class="kw">=</span> <span class="no">optimal_matching_quality</span>, <span class="fu"><a href="https://ggplot2.tidyverse.org/reference/aes.html">aes</a></span>(<span class="no">age_diff</span>)) +
  <span class="fu"><a href="https://ggplot2.tidyverse.org/reference/geom_density.html">geom_density</a></span>(<span class="kw">color</span> <span class="kw">=</span> <span class="st">"black"</span>, <span class="kw">fill</span> <span class="kw">=</span> <span class="st">"salmon"</span>) +
  <span class="fu"><a href="https://ggplot2.tidyverse.org/reference/ggtheme.html">theme_bw</a></span>() +
  <span class="fu"><a href="https://ggplot2.tidyverse.org/reference/scale_continuous.html">scale_x_continuous</a></span>(<span class="kw">limits</span> <span class="kw">=</span> <span class="no">agediff_range</span>) +
  <span class="fu"><a href="https://ggplot2.tidyverse.org/reference/labs.html">labs</a></span>(<span class="kw">title</span> <span class="kw">=</span> <span class="st">"Optimal market"</span>)

<span class="no">p_1</span> + <span class="no">p_2</span> +
  <span class="fu"><a href="https://patchwork.data-imaginist.com/reference/plot_annotation.html">plot_annotation</a></span>(<span class="kw">title</span> <span class="kw">=</span> <span class="st">'A comparison of two age-difference density plots'</span>,
                  <span class="kw">theme</span> <span class="kw">=</span> <span class="fu"><a href="https://ggplot2.tidyverse.org/reference/theme.html">theme</a></span>(<span class="kw">plot.title</span> <span class="kw">=</span> <span class="fu"><a href="https://ggplot2.tidyverse.org/reference/element.html">element_text</a></span>(<span class="kw">size</span> <span class="kw">=</span> <span class="fl">18</span>, <span class="kw">face</span> <span class="kw">=</span> <span class="st">"bold"</span>)))
<span class="co">#&gt; Warning: Removed 9 rows containing non-finite values (stat_density).</span></pre></body></html></div>
<p><img src="mate-matching_files/figure-html/unnamed-chunk-10-1.png" width="100%"></p>
</div>
  </div>

  <div class="col-md-3 hidden-xs hidden-sm" id="pkgdown-sidebar">

        <nav id="toc" data-toggle="toc"><h2 data-toc-skip>Contents</h2>
    </nav>
</div>

</div>



      <footer><div class="copyright">
  <p>Developed by Amarin Siripanich, Taha Rashidi.</p>
</div>

<div class="pkgdown">
  <p>Site built with <a href="https://pkgdown.r-lib.org/">pkgdown</a> 1.5.1.</p>
</div>

      </footer>
</div>

  
<script src="https://cdnjs.cloudflare.com/ajax/libs/docsearch.js/2.6.1/docsearch.min.js" integrity="sha256-GKvGqXDznoRYHCwKXGnuchvKSwmx9SRMrZOTh2g4Sb0=" crossorigin="anonymous"></script><script>
  docsearch({
    
    
    apiKey: '5b9cd61032daf2c5966b7cd693157aa2',
    indexName: 'dymiumcore',
    inputSelector: 'input#search-input.form-control',
    transformData: function(hits) {
      return hits.map(function (hit) {
        hit.url = updateHitURL(hit);
        return hit;
      });
    }
  });
</script>
</body>
</html>
