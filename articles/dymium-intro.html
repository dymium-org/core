<!DOCTYPE html>
<!-- Generated by pkgdown: do not edit by hand --><html lang="en">
<head>
<meta http-equiv="Content-Type" content="text/html; charset=UTF-8">
<meta charset="utf-8">
<meta http-equiv="X-UA-Compatible" content="IE=edge">
<meta name="viewport" content="width=device-width, initial-scale=1.0">
<title>Introduction to dymiumCore • dymiumCore</title>
<!-- favicons --><link rel="icon" type="image/png" sizes="16x16" href="../favicon-16x16.png">
<link rel="icon" type="image/png" sizes="32x32" href="../favicon-32x32.png">
<link rel="apple-touch-icon" type="image/png" sizes="180x180" href="../apple-touch-icon.png">
<link rel="apple-touch-icon" type="image/png" sizes="120x120" href="../apple-touch-icon-120x120.png">
<link rel="apple-touch-icon" type="image/png" sizes="76x76" href="../apple-touch-icon-76x76.png">
<link rel="apple-touch-icon" type="image/png" sizes="60x60" href="../apple-touch-icon-60x60.png">
<!-- jquery --><script src="https://cdnjs.cloudflare.com/ajax/libs/jquery/3.4.1/jquery.min.js" integrity="sha256-CSXorXvZcTkaix6Yvo6HppcZGetbYMGWSFlBw8HfCJo=" crossorigin="anonymous"></script><!-- Bootstrap --><link href="https://cdnjs.cloudflare.com/ajax/libs/bootswatch/3.4.0/readable/bootstrap.min.css" rel="stylesheet" crossorigin="anonymous">
<script src="https://cdnjs.cloudflare.com/ajax/libs/twitter-bootstrap/3.4.1/js/bootstrap.min.js" integrity="sha256-nuL8/2cJ5NDSSwnKD8VqreErSWHtnEP9E7AySL+1ev4=" crossorigin="anonymous"></script><!-- bootstrap-toc --><link rel="stylesheet" href="../bootstrap-toc.css">
<script src="../bootstrap-toc.js"></script><!-- Font Awesome icons --><link rel="stylesheet" href="https://cdnjs.cloudflare.com/ajax/libs/font-awesome/5.12.1/css/all.min.css" integrity="sha256-mmgLkCYLUQbXn0B1SRqzHar6dCnv9oZFPEC1g1cwlkk=" crossorigin="anonymous">
<link rel="stylesheet" href="https://cdnjs.cloudflare.com/ajax/libs/font-awesome/5.12.1/css/v4-shims.min.css" integrity="sha256-wZjR52fzng1pJHwx4aV2AO3yyTOXrcDW7jBpJtTwVxw=" crossorigin="anonymous">
<!-- clipboard.js --><script src="https://cdnjs.cloudflare.com/ajax/libs/clipboard.js/2.0.6/clipboard.min.js" integrity="sha256-inc5kl9MA1hkeYUt+EC3BhlIgyp/2jDIyBLS6k3UxPI=" crossorigin="anonymous"></script><!-- headroom.js --><script src="https://cdnjs.cloudflare.com/ajax/libs/headroom/0.11.0/headroom.min.js" integrity="sha256-AsUX4SJE1+yuDu5+mAVzJbuYNPHj/WroHuZ8Ir/CkE0=" crossorigin="anonymous"></script><script src="https://cdnjs.cloudflare.com/ajax/libs/headroom/0.11.0/jQuery.headroom.min.js" integrity="sha256-ZX/yNShbjqsohH1k95liqY9Gd8uOiE1S4vZc+9KQ1K4=" crossorigin="anonymous"></script><!-- pkgdown --><link href="../pkgdown.css" rel="stylesheet">
<script src="../pkgdown.js"></script><!-- docsearch --><script src="../docsearch.js"></script><link rel="stylesheet" href="https://cdnjs.cloudflare.com/ajax/libs/docsearch.js/2.6.3/docsearch.min.css" integrity="sha256-QOSRU/ra9ActyXkIBbiIB144aDBdtvXBcNc3OTNuX/Q=" crossorigin="anonymous">
<link href="../docsearch.css" rel="stylesheet">
<script src="https://cdnjs.cloudflare.com/ajax/libs/mark.js/8.11.1/jquery.mark.min.js" integrity="sha256-4HLtjeVgH0eIB3aZ9mLYF6E8oU5chNdjU6p6rrXpl9U=" crossorigin="anonymous"></script><meta property="og:title" content="Introduction to dymiumCore">
<meta property="og:description" content="dymiumCore">
<meta property="og:image" content="https://core.dymium.org/logo.png">
<!-- mathjax --><script src="https://cdnjs.cloudflare.com/ajax/libs/mathjax/2.7.5/MathJax.js" integrity="sha256-nvJJv9wWKEm88qvoQl9ekL2J+k/RWIsaSScxxlsrv8k=" crossorigin="anonymous"></script><script src="https://cdnjs.cloudflare.com/ajax/libs/mathjax/2.7.5/config/TeX-AMS-MML_HTMLorMML.js" integrity="sha256-84DKXVJXs0/F8OTMzX4UR909+jtl4G7SPypPavF+GfA=" crossorigin="anonymous"></script><!--[if lt IE 9]>
<script src="https://oss.maxcdn.com/html5shiv/3.7.3/html5shiv.min.js"></script>
<script src="https://oss.maxcdn.com/respond/1.4.2/respond.min.js"></script>
<![endif]--><!-- Global site tag (gtag.js) - Google Analytics --><script async src="https://www.googletagmanager.com/gtag/js?id=UA-158512288-1"></script><script>
  window.dataLayer = window.dataLayer || [];
  function gtag(){dataLayer.push(arguments);}
  gtag('js', new Date());

  gtag('config', 'UA-158512288-1');
</script>
</head>
<body data-spy="scroll" data-target="#toc">
    <div class="container template-article">
      <header><div class="navbar navbar-default navbar-fixed-top" role="navigation">
  <div class="container">
    <div class="navbar-header">
      <button type="button" class="navbar-toggle collapsed" data-toggle="collapse" data-target="#navbar" aria-expanded="false">
        <span class="sr-only">Toggle navigation</span>
        <span class="icon-bar"></span>
        <span class="icon-bar"></span>
        <span class="icon-bar"></span>
      </button>
      <span class="navbar-brand">
        <a class="navbar-link" href="../index.html">dymiumCore</a>
        <span class="version label label-default" data-toggle="tooltip" data-placement="bottom" title="Released version">0.1.9</span>
      </span>
    </div>

    <div id="navbar" class="navbar-collapse collapse">
      <ul class="nav navbar-nav">
<li>
  <a href="../index.html">
    <span class="fas fa fas fa-home fa-lg"></span>
     
  </a>
</li>
<li>
  <a href="../articles/dymium-intro.html">Introduction</a>
</li>
<li>
  <a href="../reference/index.html">Reference</a>
</li>
<li class="dropdown">
  <a href="#" class="dropdown-toggle" data-toggle="dropdown" role="button" aria-expanded="false">
    Articles
     
    <span class="caret"></span>
  </a>
  <ul class="dropdown-menu" role="menu">
<li>
      <a href="../articles/why-another-microsim.html">Why another microsimulation package?</a>
    </li>
    <li class="dropdown-header">Manual</li>
    <li>
      <a href="../articles/for-developers.html">For developers</a>
    </li>
    <li>
      <a href="../articles/for-modellers.html">For modellers</a>
    </li>
    <li>
      <a href="../articles/for-endusers.html">For end users</a>
    </li>
    <li class="dropdown-header">Use cases</li>
    <li>
      <a href="../articles/residential-mobility.html">Residential mobility</a>
    </li>
    <li>
      <a href="../articles/mate-matching.html">Mate matching</a>
    </li>
    <li>
      <a href="../articles/marital-status.html">Marital status</a>
    </li>
  </ul>
</li>
<li>
  <a href="../news/index.html">News</a>
</li>
      </ul>
<ul class="nav navbar-nav navbar-right">
<li>
  <a href="https://github.com/dymium-org/dymiumCore/">
    <span class="fab fa fab fa-github fa-lg"></span>
     
  </a>
</li>
      </ul>
<form class="navbar-form navbar-right hidden-xs hidden-sm" role="search">
        <div class="form-group">
          <input type="search" class="form-control" name="search-input" id="search-input" placeholder="Search..." aria-label="Search for..." autocomplete="off">
</div>
      </form>
      
    </div>
<!--/.nav-collapse -->
  </div>
<!--/.container -->
</div>
<!--/.navbar -->

      

      </header><script src="dymium-intro_files/accessible-code-block-0.0.1/empty-anchor.js"></script><script src="dymium-intro_files/htmlwidgets-1.5.1/htmlwidgets.js"></script><link href="dymium-intro_files/vis-4.20.1/vis.css" rel="stylesheet">
<script src="dymium-intro_files/vis-4.20.1/vis.min.js"></script><script src="dymium-intro_files/visNetwork-binding-2.0.9/visNetwork.js"></script><div class="row">
  <div class="col-md-9 contents">
    <div class="page-header toc-ignore">
      <h1 data-toc-skip>Introduction to dymiumCore</h1>
                        <h4 class="author">Amarin Siripanich</h4>
            
            <h4 class="date">2020-07-22</h4>
      
      <small class="dont-index">Source: <a href="https://github.com/dymium-org/dymiumCore/blob/master/vignettes/dymium-intro.Rmd"><code>vignettes/dymium-intro.Rmd</code></a></small>
      <div class="hidden name"><code>dymium-intro.Rmd</code></div>

    </div>

    
    
<p>This vignette introduces the basic building blocks for microsimulation in <code>dymiumCore</code>, how they can be put together to create a microsimulation model, and how to take advantage of existing modules from the <a href="https://github.com/dymium-org/dymiumModules">dymiumModules</a> repository.</p>
<div id="overview-of-the-building-blocks" class="section level1">
<h1 class="hasAnchor">
<a href="#overview-of-the-building-blocks" class="anchor"></a>Overview of the building blocks</h1>
<p>Microsimulation models, regardless of their study contexts, generally share the same basic components which are entities and their behaviour. The rest of the article focuses on the main building blocks of microsimulation in term of implementation.</p>
<div id="entities-and-containers" class="section level2">
<h2 class="hasAnchor">
<a href="#entities-and-containers" class="anchor"></a>Entities and Containers</h2>
<p>The main focus of <code>dymiumCore</code> is to be used for urban modelling hence we provide the entity classes that often found in the context of urban modelling. The main entity classes are <code>Agent</code>, <code>Asset</code> and <code>Environment</code>. They are inheritances of the <code>Entity</code> class. Extended from the main entity classes are <code>Individual</code>, <code>Household</code>, <code>Building</code>, <code>Firm</code> (coming soon), <code>Network</code>, <code>Zone</code> and many more to come. All the inheritances of <code>Entity</code> have the same constructor function which requires attribute data of the entities to be created and name of the id column.</p>
<p>Let’s try to create an instance of <code>Individual</code> using the <code>toy_individuals</code> dataset, microdata, that comes with <code>dymiumCore</code>. Note that, the <code>pid</code> column is its id column.</p>
<div class="sourceCode" id="cb1"><html><body><pre class="r"><span class="no">toy_individuals</span>
<span class="co">#&gt;      pid hid age    sex marital_status partner_id father_id mother_id</span>
<span class="co">#&gt;   1:   1   1  71   male  never married         NA        NA        NA</span>
<span class="co">#&gt;   2:   2   2  31 female  never married         NA        NA        NA</span>
<span class="co">#&gt;   3:   3   2  29 female  never married         NA        NA        NA</span>
<span class="co">#&gt;   4:   4   3  38   male        married          5        NA        NA</span>
<span class="co">#&gt;   5:   5   3  25 female        married          4        NA        NA</span>
<span class="co">#&gt;  ---                                                                 </span>
<span class="co">#&gt; 369: 369 143  73   male        married        368        NA        NA</span>
<span class="co">#&gt; 370: 370 144  49 female        married        371        NA        NA</span>
<span class="co">#&gt; 371: 371 144  59   male        married        370        NA        NA</span>
<span class="co">#&gt; 372: 372 144  15   male  never married         NA       371       370</span>
<span class="co">#&gt; 373: 373 144  17   male  never married         NA       371       370</span></pre></body></html></div>
<p>All entity classes are R6 class. Hence to create an object from an R6 class we need to call its constructor method which is <code>$new()</code>.</p>
<div class="sourceCode" id="cb2"><html><body><pre class="r"><span class="no">Ind</span> <span class="kw">&lt;-</span> <span class="no">Individual</span>$<span class="fu">new</span>(<span class="kw">.data</span> <span class="kw">=</span> <span class="no">toy_individuals</span>, <span class="kw">id_col</span> <span class="kw">=</span> <span class="st">"pid"</span>)
<span class="no">Ind</span>
<span class="co">#&gt; Class: Individual</span>
<span class="co">#&gt;  Inheritance: Individual &lt;- Agent &lt;- Entity &lt;- Generic &lt;- R6</span>
<span class="co">#&gt;  Number_of_entities: 373</span>
<span class="co">#&gt;  Number_of_removed_entities: 0</span>
<span class="co">#&gt;  Data[rows, cols]: attrs[373, 8]</span></pre></body></html></div>
<p>Individual agents are usually grouped into households, since household is often a more meaningful unit of analysis than individual. <code>Population</code> can be used to create <code>Individual</code> and <code>Household</code> that are linked together. <code>Population</code> is an inheritance of the <code>Container</code> class but has methods that can help you to modify, update, and inspect <code>Individual</code> and <code>Household</code> jointly.</p>
<p>Here is how you create an instance of <code>Population</code>.</p>
<div class="sourceCode" id="cb3"><html><body><pre class="r"><span class="no">Pop</span> <span class="kw">&lt;-</span> <span class="no">Population</span>$<span class="fu">new</span>(<span class="kw">ind_data</span> <span class="kw">=</span> <span class="no">toy_individuals</span>,
                      <span class="kw">hh_data</span> <span class="kw">=</span> <span class="no">toy_households</span>,
                      <span class="kw">pid_col</span> <span class="kw">=</span> <span class="st">"pid"</span>,
                      <span class="kw">hid_col</span> <span class="kw">=</span> <span class="st">"hid"</span>)
<span class="co">#&gt; [04:16:16] WARN  dymiumCore .subset2(public_bind_env, "initialize"): Creating a `hhsize` column in `hh_data` as it is not provided.</span></pre></body></html></div>
<p>You can use <code>$plot_relatioship</code> method to visualise the relationship network within a household. Note that, the nodes are labelled by their id and age (id:age).</p>
<div class="sourceCode" id="cb4"><html><body><pre class="r"><span class="no">Pop</span>$<span class="fu">plot_relatioship</span>(<span class="kw">hid</span> <span class="kw">=</span> <span class="fl">4</span>)
<span class="co">#&gt; ℹ Attribute data of Household</span>
<span class="co">#&gt;    hid did hhsize</span>
<span class="co">#&gt; 1:   4   4      5</span></pre></body></html></div>
<div class="figure">
<div id="htmlwidget-969ee3f058405e380976" style="width:672px;height:672px;" class="visNetwork html-widget"></div>
<script type="application/json" data-for="htmlwidget-969ee3f058405e380976">{"x":{"nodes":{"id":[7,8,9,10,11],"label":["7:53","8:52","9:14","10:7","11:22"],"group":["male","female","female","female","male"],"title":["<p>pid:<b>7<\/b><br>Age:<b>53<\/b><br>MS:<b>married<\/b><\/p>","<p>pid:<b>8<\/b><br>Age:<b>52<\/b><br>MS:<b>married<\/b><\/p>","<p>pid:<b>9<\/b><br>Age:<b>14<\/b><br>MS:<b>not applicable<\/b><\/p>","<p>pid:<b>10<\/b><br>Age:<b>7<\/b><br>MS:<b>not applicable<\/b><\/p>","<p>pid:<b>11<\/b><br>Age:<b>22<\/b><br>MS:<b>never married<\/b><\/p>"]},"edges":{"from":[7,8,9,10,11,7,8,9,10,11,7,8,9,10,11],"to":[null,null,7,7,null,null,null,8,8,null,8,7,null,null,null],"label":["father","father","father","father","father","mother","mother","mother","mother","mother","partner","partner","partner","partner","partner"]},"nodesToDataframe":true,"edgesToDataframe":true,"options":{"width":"100%","height":"100%","nodes":{"shape":"dot"},"manipulation":{"enabled":false},"edges":{"arrows":{"to":{"enabled":true,"scaleFactor":1}},"color":{"color":"lightblue","highlight":"red"},"shadow":true,"smooth":false},"groups":{"female":{"color":"salmon","shape":"circle","shadow":{"enabled":true}},"useDefaultGroups":true,"male":{"color":"#97C2FC","shape":"circle","shadow":{"enabled":true}}},"interaction":{"navigationButtons":true}},"groups":["male","female"],"width":null,"height":null,"idselection":{"enabled":false},"byselection":{"enabled":false},"main":null,"submain":null,"footer":null,"background":"rgba(0, 0, 0, 0)","legend":{"width":0.2,"useGroups":true,"position":"right","ncol":1,"stepX":100,"stepY":100,"zoom":true,"main":{"text":"Group","style":"font-family:Georgia, Times New Roman, Times, serif;font-weight:bold;font-size:14px;text-align:center;"}},"tooltipStay":300,"tooltipStyle":"position: fixed;visibility:hidden;padding: 5px;white-space: nowrap;font-family: verdana;font-size:14px;font-color:#000000;background-color: #f5f4ed;-moz-border-radius: 3px;-webkit-border-radius: 3px;border-radius: 3px;border: 1px solid #808074;box-shadow: 3px 3px 10px rgba(0, 0, 0, 0.2);"},"evals":[],"jsHooks":[]}</script><p class="caption">
Click on the nodes to see their attributes
</p>
</div>
<p><code>World</code> is also a <code>Container</code> class. The main purpose of a <code>Container</code> class is to store some objects that can be easily accessed using their keys. In dymium, we use <code>World</code> to contain entities, other containers, and models that we setup for simulation. We also give <code>World</code> some other responsibilities such as having the control over the simulation clock.</p>
<p>Here is how you can create a <code>World</code> object and add entities into it.</p>
<div class="sourceCode" id="cb5"><html><body><pre class="r"><span class="no">world</span> <span class="kw">&lt;-</span> <span class="no">World</span>$<span class="fu">new</span>()
<span class="co"># add Population</span>
<span class="no">world</span>$<span class="fu">add</span>(<span class="kw">x</span> <span class="kw">=</span> <span class="no">Pop</span>)
<span class="no">world</span>
<span class="co">#&gt; There are 3 items in self$Cont.</span>
<span class="co">#&gt; Class: Individual</span>
<span class="co">#&gt;  Inheritance: Individual &lt;- Agent &lt;- Entity &lt;- Generic &lt;- R6</span>
<span class="co">#&gt;  Number_of_entities: 373</span>
<span class="co">#&gt;  Number_of_removed_entities: 0</span>
<span class="co">#&gt;  Data[rows, cols]: attrs[373, 8]</span>
<span class="co">#&gt; Class: Household</span>
<span class="co">#&gt;  Inheritance: Household &lt;- Agent &lt;- Entity &lt;- Generic &lt;- R6</span>
<span class="co">#&gt;  Number_of_entities: 144</span>
<span class="co">#&gt;  Number_of_removed_entities: 0</span>
<span class="co">#&gt;  Data[rows, cols]: attrs[144, 3]</span></pre></body></html></div>
<p>Now, let’s add a glm model into our world. Note that, when a model object is added it will be warped inside <code>Model</code> so that it has a reference semantic like all other entities and containers.</p>
<div class="sourceCode" id="cb6"><html><body><pre class="r"><span class="no">my_logit_model</span> <span class="kw">&lt;-</span>
  <span class="fu"><a href="https://rdrr.io/r/stats/glm.html">glm</a></span>(<span class="fu"><a href="https://rdrr.io/r/base/AsIs.html">I</a></span>(<span class="fu"><a href="https://rdrr.io/r/base/factor.html">as.factor</a></span>(<span class="no">sex</span>)) ~ <span class="no">age</span> + <span class="no">marital_status</span>,
      <span class="kw">data</span> <span class="kw">=</span> <span class="no">toy_individuals</span>,
      <span class="kw">family</span> <span class="kw">=</span> <span class="fu"><a href="https://rdrr.io/r/stats/family.html">binomial</a></span>(<span class="kw">link</span> <span class="kw">=</span> <span class="st">"logit"</span>))
<span class="no">world</span>$<span class="fu">add</span>(<span class="kw">x</span> <span class="kw">=</span> <span class="no">my_logit_model</span>, <span class="kw">name</span> <span class="kw">=</span> <span class="st">"my_logit_model"</span>)</pre></body></html></div>
<p>To access the objects that we have just added we can either use one of these methods</p>
<p>Use <code>$get(name)</code> to get any added object using its name. If you add an Entity object to World you do not need to name it as it will be named as its class name. But for a model object, you will need to give it a name.</p>
<div class="sourceCode" id="cb7"><html><body><pre class="r"><span class="no">world</span>$<span class="fu"><a href="https://rdrr.io/r/base/get.html">get</a></span>(<span class="st">"Individual"</span>)
<span class="co">#&gt; Class: Individual</span>
<span class="co">#&gt;  Inheritance: Individual &lt;- Agent &lt;- Entity &lt;- Generic &lt;- R6</span>
<span class="co">#&gt;  Number_of_entities: 373</span>
<span class="co">#&gt;  Number_of_removed_entities: 0</span>
<span class="co">#&gt;  Data[rows, cols]: attrs[373, 8]</span>
<span class="no">world</span>$<span class="fu"><a href="https://rdrr.io/r/base/get.html">get</a></span>(<span class="st">"my_logit_model"</span>)
<span class="co">#&gt; </span>
<span class="co">#&gt; Call:  glm(formula = I(as.factor(sex)) ~ age + marital_status, family = binomial(link = "logit"), </span>
<span class="co">#&gt;     data = toy_individuals)</span>
<span class="co">#&gt; </span>
<span class="co">#&gt; Coefficients:</span>
<span class="co">#&gt;                  (Intercept)                           age  </span>
<span class="co">#&gt;                    -1.002352                      0.008609  </span>
<span class="co">#&gt;        marital_statusmarried   marital_statusnever married  </span>
<span class="co">#&gt;                     0.579704                      1.186234  </span>
<span class="co">#&gt; marital_statusnot applicable       marital_statusseparated  </span>
<span class="co">#&gt;                     0.751807                      0.620704  </span>
<span class="co">#&gt;        marital_statuswidowed  </span>
<span class="co">#&gt;                    -0.531718  </span>
<span class="co">#&gt; </span>
<span class="co">#&gt; Degrees of Freedom: 372 Total (i.e. Null);  366 Residual</span>
<span class="co">#&gt; Null Deviance:       516.9 </span>
<span class="co">#&gt; Residual Deviance: 507.9     AIC: 521.9</span></pre></body></html></div>
<p>Or you can access them using these fields of <code>World</code>. As the names suggest, all objects added are categorised into differnt fields by their class for easy access.</p>
<div class="sourceCode" id="cb8"><html><body><pre class="r"><span class="no">world</span>$<span class="no">entities</span>
<span class="co">#&gt; $Individual</span>
<span class="co">#&gt; Class: Individual</span>
<span class="co">#&gt;  Inheritance: Individual &lt;- Agent &lt;- Entity &lt;- Generic &lt;- R6</span>
<span class="co">#&gt;  Number_of_entities: 373</span>
<span class="co">#&gt;  Number_of_removed_entities: 0</span>
<span class="co">#&gt;  Data[rows, cols]: attrs[373, 8]</span>
<span class="co">#&gt; </span>
<span class="co">#&gt; $Household</span>
<span class="co">#&gt; Class: Household</span>
<span class="co">#&gt;  Inheritance: Household &lt;- Agent &lt;- Entity &lt;- Generic &lt;- R6</span>
<span class="co">#&gt;  Number_of_entities: 144</span>
<span class="co">#&gt;  Number_of_removed_entities: 0</span>
<span class="co">#&gt;  Data[rows, cols]: attrs[144, 3]</span>
<span class="no">world</span>$<span class="no">entities</span>$<span class="no">Individual</span>
<span class="co">#&gt; Class: Individual</span>
<span class="co">#&gt;  Inheritance: Individual &lt;- Agent &lt;- Entity &lt;- Generic &lt;- R6</span>
<span class="co">#&gt;  Number_of_entities: 373</span>
<span class="co">#&gt;  Number_of_removed_entities: 0</span>
<span class="co">#&gt;  Data[rows, cols]: attrs[373, 8]</span>
<span class="no">world</span>$<span class="no">models</span>
<span class="co">#&gt; $my_logit_model</span>
<span class="co">#&gt; </span>
<span class="co">#&gt; Call:  glm(formula = I(as.factor(sex)) ~ age + marital_status, family = binomial(link = "logit"), </span>
<span class="co">#&gt;     data = toy_individuals)</span>
<span class="co">#&gt; </span>
<span class="co">#&gt; Coefficients:</span>
<span class="co">#&gt;                  (Intercept)                           age  </span>
<span class="co">#&gt;                    -1.002352                      0.008609  </span>
<span class="co">#&gt;        marital_statusmarried   marital_statusnever married  </span>
<span class="co">#&gt;                     0.579704                      1.186234  </span>
<span class="co">#&gt; marital_statusnot applicable       marital_statusseparated  </span>
<span class="co">#&gt;                     0.751807                      0.620704  </span>
<span class="co">#&gt;        marital_statuswidowed  </span>
<span class="co">#&gt;                    -0.531718  </span>
<span class="co">#&gt; </span>
<span class="co">#&gt; Degrees of Freedom: 372 Total (i.e. Null);  366 Residual</span>
<span class="co">#&gt; Null Deviance:       516.9 </span>
<span class="co">#&gt; Residual Deviance: 507.9     AIC: 521.9</span>
<span class="no">world</span>$<span class="no">containers</span>
<span class="co">#&gt; $Population</span>
<span class="co">#&gt; There are 2 items in self$Cont.</span>
<span class="co">#&gt; Class: Individual</span>
<span class="co">#&gt;  Inheritance: Individual &lt;- Agent &lt;- Entity &lt;- Generic &lt;- R6</span>
<span class="co">#&gt;  Number_of_entities: 373</span>
<span class="co">#&gt;  Number_of_removed_entities: 0</span>
<span class="co">#&gt;  Data[rows, cols]: attrs[373, 8]</span>
<span class="co">#&gt; Class: Household</span>
<span class="co">#&gt;  Inheritance: Household &lt;- Agent &lt;- Entity &lt;- Generic &lt;- R6</span>
<span class="co">#&gt;  Number_of_entities: 144</span>
<span class="co">#&gt;  Number_of_removed_entities: 0</span>
<span class="co">#&gt;  Data[rows, cols]: attrs[144, 3]</span></pre></body></html></div>
<p>The <code>$Cont</code> field holds all objects that <code>World</code> contains.</p>
<div class="sourceCode" id="cb9"><html><body><pre class="r"><span class="no">world</span>$<span class="no">Cont</span>
<span class="co">#&gt; $Individual</span>
<span class="co">#&gt; Class: Individual</span>
<span class="co">#&gt;  Inheritance: Individual &lt;- Agent &lt;- Entity &lt;- Generic &lt;- R6</span>
<span class="co">#&gt;  Number_of_entities: 373</span>
<span class="co">#&gt;  Number_of_removed_entities: 0</span>
<span class="co">#&gt;  Data[rows, cols]: attrs[373, 8]</span>
<span class="co">#&gt; </span>
<span class="co">#&gt; $Household</span>
<span class="co">#&gt; Class: Household</span>
<span class="co">#&gt;  Inheritance: Household &lt;- Agent &lt;- Entity &lt;- Generic &lt;- R6</span>
<span class="co">#&gt;  Number_of_entities: 144</span>
<span class="co">#&gt;  Number_of_removed_entities: 0</span>
<span class="co">#&gt;  Data[rows, cols]: attrs[144, 3]</span>
<span class="co">#&gt; </span>
<span class="co">#&gt; $Population</span>
<span class="co">#&gt; There are 2 items in self$Cont.</span>
<span class="co">#&gt; Class: Individual</span>
<span class="co">#&gt;  Inheritance: Individual &lt;- Agent &lt;- Entity &lt;- Generic &lt;- R6</span>
<span class="co">#&gt;  Number_of_entities: 373</span>
<span class="co">#&gt;  Number_of_removed_entities: 0</span>
<span class="co">#&gt;  Data[rows, cols]: attrs[373, 8]</span>
<span class="co">#&gt; Class: Household</span>
<span class="co">#&gt;  Inheritance: Household &lt;- Agent &lt;- Entity &lt;- Generic &lt;- R6</span>
<span class="co">#&gt;  Number_of_entities: 144</span>
<span class="co">#&gt;  Number_of_removed_entities: 0</span>
<span class="co">#&gt;  Data[rows, cols]: attrs[144, 3]</span>
<span class="co">#&gt; </span>
<span class="co">#&gt; $my_logit_model</span>
<span class="co">#&gt; </span>
<span class="co">#&gt; Call:  glm(formula = I(as.factor(sex)) ~ age + marital_status, family = binomial(link = "logit"), </span>
<span class="co">#&gt;     data = toy_individuals)</span>
<span class="co">#&gt; </span>
<span class="co">#&gt; Coefficients:</span>
<span class="co">#&gt;                  (Intercept)                           age  </span>
<span class="co">#&gt;                    -1.002352                      0.008609  </span>
<span class="co">#&gt;        marital_statusmarried   marital_statusnever married  </span>
<span class="co">#&gt;                     0.579704                      1.186234  </span>
<span class="co">#&gt; marital_statusnot applicable       marital_statusseparated  </span>
<span class="co">#&gt;                     0.751807                      0.620704  </span>
<span class="co">#&gt;        marital_statuswidowed  </span>
<span class="co">#&gt;                    -0.531718  </span>
<span class="co">#&gt; </span>
<span class="co">#&gt; Degrees of Freedom: 372 Total (i.e. Null);  366 Residual</span>
<span class="co">#&gt; Null Deviance:       516.9 </span>
<span class="co">#&gt; Residual Deviance: 507.9     AIC: 521.9</span></pre></body></html></div>
</div>
<div id="transition" class="section level2">
<h2 class="hasAnchor">
<a href="#transition" class="anchor"></a>Transition</h2>
<p>In a microsimulation model, entities are given rules for them to follow under different conditions. A rule can simply be an ifelse statement such as:</p>
<pre><code>if age is greater than 16:
    can_marry 
else:
    cant_marry</code></pre>
<p>This rule is deterministic since it makes sure that all individual agents above the age of 16 can get married.</p>
<p>To use probabilistic rules you may want to use a rate-based model or a classification model (binary logit model, multinomial logit model, hazard-based model, random forest, and artificial neural network) that takes attributes of the entities as the input variables.</p>
<p><code>dymiumCore</code> provides <code>TransitionClassification</code> and <code>TransitionRegression</code>, both are [R6::R6Class], which take in a rule and entities then simulate the outcomes of the entities given the provided rule. For probabilistic rules, Monte Carlo simulation will be performed based on the probabilistic values from the rules.</p>
<div id="supported-models" class="section level3">
<h3 class="hasAnchor">
<a href="#supported-models" class="anchor"></a>Supported models</h3>
<p>Currently, <code>dymiumCore</code> only supports the model objects fitted using <code>caret</code> and <code>stats</code> in the <code>Transition</code> classes.</p>
<table class="table">
<colgroup>
<col width="8%">
<col width="15%">
<col width="58%">
<col width="17%">
</colgroup>
<thead><tr class="header">
<th align="right">Package</th>
<th align="right">Class</th>
<th align="right">Model types</th>
<th align="right">status</th>
</tr></thead>
<tbody>
<tr class="odd">
<td align="right">caret</td>
<td align="right"><code>train</code></td>
<td align="right">classification and regression models</td>
<td align="right">supported</td>
</tr>
<tr class="even">
<td align="right">stats</td>
<td align="right">
<code>lm</code> &amp; <code>glm</code>
</td>
<td align="right">generalised regression models</td>
<td align="right">supported</td>
</tr>
<tr class="odd">
<td align="right">mlr3</td>
<td align="right"><code>Learner</code></td>
<td align="right">classification, survival, and regression models</td>
<td align="right">supported (only classification models)</td>
</tr>
<tr class="even">
<td align="right">mlogit</td>
<td align="right"><code>mlogit</code></td>
<td align="right">multinomial logit models</td>
<td align="right">in-development</td>
</tr>
</tbody>
</table>
<p>The example below shows how one can use <code>caret</code> to fit a multinomial model and use the model to simulate marital status of individual agents with <code>TransitionClassification</code>.</p>
<p>First we create a world object for testing using the <code><a href="../reference/create_toy_world.html">create_toy_world()</a></code> function. This function creates a world object named <code>world</code> in the global environment.</p>
<div class="sourceCode" id="cb11"><html><body><pre class="r"><span class="co"># create a toy world named `world` in the global environment</span>
<span class="fu"><a href="../reference/create_toy_world.html">create_toy_world</a></span>(<span class="kw">add_toy_zones</span> <span class="kw">=</span> <span class="fl">FALSE</span>) <span class="co"># omitting `toy_zones`</span>
<span class="co">#&gt; [04:16:16] WARN  dymiumCore .subset2(public_bind_env, "initialize"): Creating a `hhsize` column in `hh_data` as it is not provided.</span></pre></body></html></div>
<p>To create a shorthand access to the <code>Individual</code> object inside <code>world</code> we use the <code>$get()</code> method.</p>
<div class="sourceCode" id="cb12"><html><body><pre class="r"><span class="co"># get the reference of Individual</span>
<span class="no">Ind</span> <span class="kw">&lt;-</span> <span class="no">world</span>$<span class="fu"><a href="https://rdrr.io/r/base/get.html">get</a></span>(<span class="st">"Individual"</span>)</pre></body></html></div>
<p>Let’s create a table that shows the counts of marital status of the individual agents in <code>Individual</code>.</p>
<div class="sourceCode" id="cb13"><html><body><pre class="r"><span class="fu"><a href="https://rdrr.io/r/base/table.html">table</a></span>(<span class="no">Ind</span>$<span class="fu">get_attr</span>(<span class="st">"marital_status"</span>))
<span class="co">#&gt; </span>
<span class="co">#&gt;       divorced        married  never married not applicable      separated </span>
<span class="co">#&gt;             22            174            108             53              6 </span>
<span class="co">#&gt;        widowed </span>
<span class="co">#&gt;             10</span></pre></body></html></div>
<p>Now we want to fit a multinomial model (predicts multiple choices) using the <code>caret</code> package. <code>caret</code> may asks you to install <code>nnet</code> which provides an implementation of a multinomial model through its <code>multinom</code> function.</p>
<div class="sourceCode" id="cb14"><html><body><pre class="r"><span class="co"># fit a multinomial model where `y` is marital status and `x`s are age, age squared and sex.</span>
<span class="no">marital_status_model</span> <span class="kw">&lt;-</span>
  <span class="kw pkg">caret</span><span class="kw ns">::</span><span class="fu"><a href="https://rdrr.io/pkg/caret/man/train.html">train</a></span>(<span class="no">marital_status</span> ~ <span class="no">age</span> + <span class="fu"><a href="https://rdrr.io/r/base/AsIs.html">I</a></span>(<span class="no">age</span> ^ <span class="fl">2</span>) + <span class="no">sex</span>,
               <span class="kw">data</span> <span class="kw">=</span> <span class="no">toy_individuals</span>,
               <span class="kw">method</span> <span class="kw">=</span> <span class="st">"multinom"</span>,
               <span class="kw">trControl</span> <span class="kw">=</span> <span class="kw pkg">caret</span><span class="kw ns">::</span><span class="fu"><a href="https://rdrr.io/pkg/caret/man/trainControl.html">trainControl</a></span>(<span class="kw">method</span> <span class="kw">=</span> <span class="st">"none"</span>))
<span class="co">#&gt; # weights:  30 (20 variable)</span>
<span class="co">#&gt; initial  value 668.326282 </span>
<span class="co">#&gt; iter  10 value 389.790237</span>
<span class="co">#&gt; iter  20 value 231.417305</span>
<span class="co">#&gt; iter  30 value 214.983829</span>
<span class="co">#&gt; iter  40 value 211.791569</span>
<span class="co">#&gt; iter  50 value 210.395571</span>
<span class="co">#&gt; iter  60 value 210.092816</span>
<span class="co">#&gt; iter  70 value 209.234347</span>
<span class="co">#&gt; iter  80 value 208.603864</span>
<span class="co">#&gt; final  value 208.583038 </span>
<span class="co">#&gt; converged</span></pre></body></html></div>
<p><code>TransitionClassification</code> and <code>TransitionRegression</code> are R6 classes and to use them we need to call its constructor function. The first argument in the constructor function can be any object that inherits <code>Entity</code> and follows by the model argument which must be one of the supported models or special cases that will be discussed in the next section. There are additional arguments that can be set such as <code>target</code>, <code>targeted_agents</code> and <code>model_by_id</code> that can be used. Please see its documentation for more information about those extra arguments.</p>
<div class="sourceCode" id="cb15"><html><body><pre class="r"><span class="no">TransMaritalStatus</span> <span class="kw">&lt;-</span> <span class="no">TransitionClassification</span>$<span class="fu">new</span>(<span class="kw">x</span> <span class="kw">=</span> <span class="no">Ind</span>, <span class="kw">model</span> <span class="kw">=</span> <span class="no">marital_status_model</span>)</pre></body></html></div>
<p>Creating a <code>Transition</code> object will trigger a series of processes under the hood, including stochastically simulating decisions using the given model. Which in this case, TransitionClassification stochastically simulate marital status of the individual agents using the multinomial model.</p>
<div class="sourceCode" id="cb16"><html><body><pre class="r"><span class="no">TransMaritalStatus</span>
<span class="co">#&gt; There are 373 Individual agents with 6 unique responses of type character {divorced: 17 | married: 180 | never married: 108 | not applicable: 53 | separated: 8 | widowed: 7}</span></pre></body></html></div>
<p>To see the simulation result use the <code>$get_result()</code> method.</p>
<div class="sourceCode" id="cb17"><html><body><pre class="r"><span class="co"># get the result in a data.table</span>
<span class="no">TransMaritalStatus</span>$<span class="fu">get_result</span>()
<span class="co">#&gt;       id      response</span>
<span class="co">#&gt;   1:   1       married</span>
<span class="co">#&gt;   2:   2 never married</span>
<span class="co">#&gt;   3:   3 never married</span>
<span class="co">#&gt;   4:   4       married</span>
<span class="co">#&gt;   5:   5 never married</span>
<span class="co">#&gt;  ---                  </span>
<span class="co">#&gt; 369: 369       married</span>
<span class="co">#&gt; 370: 370      divorced</span>
<span class="co">#&gt; 371: 371       married</span>
<span class="co">#&gt; 372: 372 never married</span>
<span class="co">#&gt; 373: 373 never married</span></pre></body></html></div>
<p>We can update marital status of all individual agents with new values from the simulation using the <code>$update_agents</code> method and set <code>attr</code> to <code>marital_status</code>. Notice that we passed a reference to <code>Individual</code> when we constructed <code>TransMaritalStatus</code> so <code>update_agents</code> knows which one to update.</p>
<div class="sourceCode" id="cb18"><html><body><pre class="r"><span class="co"># update the marital status of all individual agents using the simulated result</span>
<span class="no">TransMaritalStatus</span>$<span class="fu">update_agents</span>(<span class="kw">attr</span> <span class="kw">=</span> <span class="st">"marital_status"</span>)</pre></body></html></div>
<p>or we can update marital status of the individual agents explicitly using <code>data.table</code> operations as the follow:</p>
<div class="sourceCode" id="cb19"><html><body><pre class="r"><span class="co"># first we must get the indexes of all the ids. Note that the order of the indexes</span>
<span class="co"># must correspond to their ids. You can use the `$get_idx()` method to get ordered indexes.</span>
<span class="no">idx</span> <span class="kw">&lt;-</span> <span class="no">Ind</span>$<span class="fu">get_idx</span>(<span class="kw">ids</span> <span class="kw">=</span> <span class="no">TransMaritalStatus</span>$<span class="fu">get_result</span>()<span class="kw">[[</span><span class="st">"id"</span>]])

<span class="co"># there are two ways that you can update marital status that is in the attribute data (`attrs`)</span>
<span class="co"># of the individual agents</span>
<span class="co"># (1) using data.table syntax.</span>
<span class="no">Ind</span>$<span class="fu">get_data</span>(<span class="kw">name</span> <span class="kw">=</span> <span class="st">"attrs"</span>, <span class="kw">copy</span> <span class="kw">=</span> <span class="fl">FALSE</span>)[<span class="no">idx</span>, <span class="no">marital_status</span> <span class="kw">:=</span> <span class="no">TransMaritalStatus</span>$<span class="fu">get_result</span>()<span class="kw">[[</span><span class="st">"response"</span>]]]

<span class="co"># (2) using the data.table's `set` function.</span>
<span class="kw pkg">data.table</span><span class="kw ns">::</span><span class="fu"><a href="https://Rdatatable.gitlab.io/data.table/reference/assign.html">set</a></span>(<span class="kw">x</span> <span class="kw">=</span> <span class="no">Ind</span>$<span class="fu">get_data</span>(<span class="kw">name</span> <span class="kw">=</span> <span class="st">"attrs"</span>, <span class="kw">copy</span> <span class="kw">=</span> <span class="fl">FALSE</span>),
                <span class="kw">i</span> <span class="kw">=</span> <span class="no">idx</span>,
                <span class="kw">j</span> <span class="kw">=</span> <span class="st">"marital_status"</span>,
                <span class="kw">value</span> <span class="kw">=</span> <span class="no">TransMaritalStatus</span>$<span class="fu">get_result</span>()<span class="kw">[[</span><span class="st">"response"</span>]])</pre></body></html></div>
<p>Now let’s see the total count of each marital status again.</p>
<div class="sourceCode" id="cb20"><html><body><pre class="r"><span class="co"># count marital status of all individuals</span>
<span class="fu"><a href="https://rdrr.io/r/base/table.html">table</a></span>(<span class="no">Ind</span>$<span class="fu">get_attr</span>(<span class="st">"marital_status"</span>))
<span class="co">#&gt; </span>
<span class="co">#&gt;       divorced        married  never married not applicable      separated </span>
<span class="co">#&gt;             17            180            108             53              8 </span>
<span class="co">#&gt;        widowed </span>
<span class="co">#&gt;              7</span></pre></body></html></div>
</div>
<div id="using-transition-probabilities" class="section level3">
<h3 class="hasAnchor">
<a href="#using-transition-probabilities" class="anchor"></a>Using transition probabilities</h3>
<p>In microsimulation, modellers often use transition probabilities that they obtained from official sources. Hence, <strong>dymiumCore</strong> provides an easy step to use those transition probabilities in <code>Transition</code>. <strong>A static rate model</strong>, <strong>a dynamic rate model</strong>, and <strong>a enumerated choice model</strong> can be provided in a data.table format. When a data.table is provided as the model argument to <code>Transition</code>, <code>Transition</code> will figure out which of the three models the provided data.table matches based on the following criteria.</p>
<p>It is <strong>a static rate model</strong>, if the provided data.table contains a numeric <code>prob</code> column with values between 0 to 1.</p>
<div class="sourceCode" id="cb21"><html><body><pre class="r"><span class="fu"><a href="https://rdrr.io/r/base/library.html">library</a></span>(<span class="no">data.table</span>) <span class="co"># use install.packages("data.table") to install</span>

(<span class="no">rate_based_model</span> <span class="kw">&lt;-</span>
  <span class="fu"><a href="https://Rdatatable.gitlab.io/data.table/reference/data.table.html">data.table</a></span>(
  <span class="kw">sex</span> <span class="kw">=</span> <span class="fu"><a href="https://rdrr.io/r/base/c.html">c</a></span>(<span class="st">"male"</span>, <span class="st">"female"</span>),
  <span class="kw">prob</span> <span class="kw">=</span> <span class="fu"><a href="https://rdrr.io/r/base/c.html">c</a></span>(<span class="fl">0.3</span>, <span class="fl">0.2</span>)
))
<span class="co">#&gt;       sex prob</span>
<span class="co">#&gt; 1:   male  0.3</span>
<span class="co">#&gt; 2: female  0.2</span></pre></body></html></div>
<p>It is <strong>a dynamic rate model</strong>, if the provided data.table contains columns that indicate time periods with a prefix <code>t_</code> follow by a numeric value i.e. <code>t_0</code>, <code>t_2011</code>, <code>t_2050</code>. Those time period columns must be of type numeric and the values under those columns must be within 0 to 1.</p>
<div class="sourceCode" id="cb22"><html><body><pre class="r">(<span class="no">dynamic_rate_based_model</span> <span class="kw">&lt;-</span>
  <span class="fu"><a href="https://Rdatatable.gitlab.io/data.table/reference/data.table.html">data.table</a></span>(
  <span class="kw">sex</span> <span class="kw">=</span> <span class="fu"><a href="https://rdrr.io/r/base/c.html">c</a></span>(<span class="st">"male"</span>, <span class="st">"female"</span>),
  <span class="kw">prob</span> <span class="kw">=</span> <span class="fu"><a href="https://rdrr.io/r/base/c.html">c</a></span>(<span class="fl">0.3</span>, <span class="fl">0.2</span>),
  <span class="kw">t_2010</span> <span class="kw">=</span> <span class="fu"><a href="https://rdrr.io/r/base/c.html">c</a></span>(<span class="fl">0.5</span>, <span class="fl">0.2</span>),
  <span class="kw">t_2011</span> <span class="kw">=</span> <span class="fu"><a href="https://rdrr.io/r/base/c.html">c</a></span>(<span class="fl">0.3</span>, <span class="fl">0.1</span>),
  <span class="kw">t_2012</span> <span class="kw">=</span> <span class="fu"><a href="https://rdrr.io/r/base/c.html">c</a></span>(<span class="fl">0.4</span>, <span class="fl">0.3</span>)
))
<span class="co">#&gt;       sex prob t_2010 t_2011 t_2012</span>
<span class="co">#&gt; 1:   male  0.3    0.5    0.3    0.4</span>
<span class="co">#&gt; 2: female  0.2    0.2    0.1    0.3</span></pre></body></html></div>
<p>It is <strong>a choice model</strong>, if the provided data.table has list columns with names <code>probs</code> and <code>choices</code> containing numeric vectors and character vectors, respectively.</p>
<div class="sourceCode" id="cb23"><html><body><pre class="r">(<span class="no">choice_model</span> <span class="kw">&lt;-</span>
  <span class="fu"><a href="https://Rdatatable.gitlab.io/data.table/reference/data.table.html">data.table</a></span>(
    <span class="kw">sex</span> <span class="kw">=</span> <span class="fu"><a href="https://rdrr.io/r/base/c.html">c</a></span>(<span class="st">'male'</span>, <span class="st">'female'</span>),
    <span class="kw">probs</span> <span class="kw">=</span> <span class="fu"><a href="https://rdrr.io/r/base/list.html">list</a></span>(<span class="fu"><a href="https://rdrr.io/r/base/c.html">c</a></span>(<span class="fl">0.3</span>,<span class="fl">0.7</span>), <span class="fu"><a href="https://rdrr.io/r/base/c.html">c</a></span>(<span class="fl">0.4</span>,<span class="fl">0.6</span>)),
    <span class="kw">choices</span> <span class="kw">=</span> <span class="fu"><a href="https://rdrr.io/r/base/list.html">list</a></span>(<span class="fu"><a href="https://rdrr.io/r/base/c.html">c</a></span>(<span class="st">'can drive'</span>, <span class="st">'cannot drive'</span>), <span class="fu"><a href="https://rdrr.io/r/base/c.html">c</a></span>(<span class="st">'can drive'</span>, <span class="st">'cannot drive'</span>))
))
<span class="co">#&gt;       sex   probs                choices</span>
<span class="co">#&gt; 1:   male 0.3,0.7 can drive,cannot drive</span>
<span class="co">#&gt; 2: female 0.4,0.6 can drive,cannot drive</span></pre></body></html></div>
<p><strong>Note that</strong>, if the the provided data.table matches more than one of the three formats then <code>Transition</code> will raise an error.</p>
<p><strong>Suggestion:</strong> you can import transition probability tables that are in a <code>csv</code> format or a <code>.xlsx</code> format to R using the <code>fread</code> function from the <code>data.table</code> package or <code><a href="https://rdrr.io/r/utils/read.table.html">read.csv()</a></code> from the <code>utils</code> package that comes preinstalled with R or <code>read_xlsx()</code> from the <code>readxl</code> package for xlsx files.</p>
<ul>
<li>A named <code>list</code> can be used to represent choices, where the names of the list are choices and their values are their associated probabilities.</li>
</ul>
<div class="sourceCode" id="cb24"><html><body><pre class="r">(<span class="no">binary_list_model</span> <span class="kw">&lt;-</span> <span class="fu"><a href="https://rdrr.io/r/base/list.html">list</a></span>(<span class="kw">yes</span> <span class="kw">=</span> <span class="fl">0.05</span>, <span class="kw">no</span> <span class="kw">=</span> <span class="fl">0.95</span>))
<span class="co">#&gt; $yes</span>
<span class="co">#&gt; [1] 0.05</span>
<span class="co">#&gt; </span>
<span class="co">#&gt; $no</span>
<span class="co">#&gt; [1] 0.95</span>
(<span class="no">marriage_model</span> <span class="kw">&lt;-</span> <span class="fu"><a href="https://rdrr.io/r/base/list.html">list</a></span>(<span class="kw">married</span> <span class="kw">=</span> <span class="fl">0.05</span>, <span class="kw">not_married</span> <span class="kw">=</span> <span class="fl">0.95</span>))
<span class="co">#&gt; $married</span>
<span class="co">#&gt; [1] 0.05</span>
<span class="co">#&gt; </span>
<span class="co">#&gt; $not_married</span>
<span class="co">#&gt; [1] 0.95</span>
(<span class="no">employment_model</span> <span class="kw">&lt;-</span> <span class="fu"><a href="https://rdrr.io/r/base/list.html">list</a></span>(<span class="kw">employed</span> <span class="kw">=</span> <span class="fl">0.4</span>, <span class="kw">unemployed</span> <span class="kw">=</span> <span class="fl">0.2</span>, <span class="kw">not_in_labour_force</span> <span class="kw">=</span> <span class="fl">0.3</span>))
<span class="co">#&gt; $employed</span>
<span class="co">#&gt; [1] 0.4</span>
<span class="co">#&gt; </span>
<span class="co">#&gt; $unemployed</span>
<span class="co">#&gt; [1] 0.2</span>
<span class="co">#&gt; </span>
<span class="co">#&gt; $not_in_labour_force</span>
<span class="co">#&gt; [1] 0.3</span></pre></body></html></div>
<p>In a binary choice model, it is recommended that the outcome variable should be coded as “yes” and “no” as many of the modules available at <a href="https://github.com/dymium-org/dymiumModules">dymium-org/dymiumModules</a> use with this convention.</p>
</div>
</div>
<div id="market" class="section level2">
<h2 class="hasAnchor">
<a href="#market" class="anchor"></a>Market</h2>
<p>The market component of dymium may be regarded as its first step to incorporating an aspect of agent-based simulation to its microsimulation component. In short, market is where entities can interact with one another to achieve a pre-defined goal. For example, mate matching is an important part in a closed population simulation where individual agents are partnered through some matching rules that are given to them. The rules can be as simple as minimising the age difference between two individual agents of opposite sex or differences in other socioeconomic characteristics.</p>
<p>Market can be an abstraction of a real-estate bidding market, a mate matching market, a labour market, etc. The entire market are separated into two sides (i.e. proposers and proprosees, buyers and sellers, labours and firms). Interaction between agents can be one-sided or two-sided depends on the matching mechanism that is used. When it is one-sided only agents from one side of the market make the decision about what they get based on their preference. When it is the matching problem is two-sided one then both sides of the market evaluate evaluate options available to them and interact in a way that mimic bidding.</p>
<p>Note that, the number of alternatives available to each agent is customisable to realistically represent a matching situation that is being simulated. For example, in a housing search situation, it might be inappropiate to assume that all relocating households have perfect knowledge about all the available dwelling units that are on the market at any moment in time. Hence, the modeller might want to limit the number of alternatives available in the choiceset of each household or the number of zones that the households look for their options.</p>
<p>Currently, there are two implementations of market matching algorithms which are</p>
<ul>
<li>Stochastic matching (<code>MatchingMarketStochastic</code>) and</li>
<li>Optimal matching (<code>MatchingMarketOptimal</code>)</li>
</ul>
<p>In <code>MatchingMarketStochastic</code>, only one-sided matching problems can be solved. All agents that are seeking a match are randomly ordered into a virtual queue. The first agent in the queue gets to select an alternative among all the alternatives that available to it. While in <code>MatchingMarketOptimal</code>, both one-sided and two-sided problems can be solved. All agents are aware of all the available alternatives (e.g. houses, partners, etc.) in the market. This generally a very strong assumption. Hence, to mitigate such strong assumption the whole market can be further segmented into sub markets where agents that are more alike or geographically near one others are stratified into the same sub market and only aware of each others and not those that are their unlikely matches.</p>
<p>To learn more about <code>Market</code> see the ‘mate matching’ use case under Articles.</p>
</div>
<div id="logging" class="section level2">
<h2 class="hasAnchor">
<a href="#logging" class="anchor"></a>Logging</h2>
<p>There are a few ways that you can log in dymium. To choose which of the logging methods is suitable in your please consider the following. Please note that, this subsection is only to give a brief overview of the methods so please see its documentation for more details.</p>
<div id="logging-with-lgr" class="section level3">
<h3 class="hasAnchor">
<a href="#logging-with-lgr" class="anchor"></a>Logging with <code>lgr</code>
</h3>
<p>The <code>lgr</code> package is used by dymiumCore internally. This sometimes give warnings on the console. You can also see lower-level log messages if you change the log threshold.</p>
<div class="sourceCode" id="cb25"><html><body><pre class="r"><span class="kw pkg">dymiumCore</span><span class="kw ns">:::</span><span class="no">lg</span>$<span class="fu">set_threshold</span>(<span class="st">"info"</span>)
<span class="kw pkg">dymiumCore</span><span class="kw ns">:::</span><span class="no">lg</span>$<span class="fu">set_threshold</span>(<span class="st">"trace"</span>)</pre></body></html></div>
<p>The default threshold for is set to <code>warn</code> which only shows warning messages and above (i.e. debug, fatal). As you can see, the internal logger is not exported hence it is not meant to be used by the end-user.</p>
<p><code>lgr</code> is also used in dymium modules. If you create a new module using <code><a href="../reference/use_module.html">use_module()</a></code> a lgr logger will be available for you to use within your event functions, see <code>logger.R</code> in your module folder.</p>
<p>There are many powerful stuffs you can do with <code>lgr</code> and to learn more about it please see its <a href="https://s-fleck.github.io/lgr/articles/lgr.html">vignette</a>.</p>
</div>
<div id="logging-with-genericlog" class="section level3">
<h3 class="hasAnchor">
<a href="#logging-with-genericlog" class="anchor"></a>Logging with <code>Generic$log()</code>
</h3>
<p>All classes that inherit <code>Generic</code>, namely <code>Entity</code> and <code>Container</code>, have the <code><a href="https://rdrr.io/r/base/Log.html">log()</a></code> method available to them. The main purpose of this function is to give the user a convinient way to log simulation outputs. <code><a href="../reference/add_log.html">get_log()</a></code> can be used on objects that have the <code>$log()</code> method to gather all logs.</p>
<div class="sourceCode" id="cb26"><html><body><pre class="r"><span class="fu"><a href="../reference/create_toy_world.html">create_toy_world</a></span>(<span class="kw">add_toy_zones</span> <span class="kw">=</span> <span class="fl">FALSE</span>)
<span class="co">#&gt; [04:16:19] WARN  dymiumCore .subset2(public_bind_env, "initialize"): Creating a `hhsize` column in `hh_data` as it is not provided.</span>
<span class="no">total_no_individuals</span> <span class="kw">&lt;-</span> <span class="no">world</span>$<span class="no">entities</span>$<span class="no">Individual</span>$<span class="fu">n</span>()
<span class="no">world</span>$<span class="no">entities</span>$<span class="no">Individual</span>$<span class="fu"><a href="https://rdrr.io/r/base/Log.html">log</a></span>(<span class="kw">desc</span> <span class="kw">=</span> <span class="st">"total_no_individuals"</span>, <span class="kw">value</span> <span class="kw">=</span> <span class="no">total_no_individuals</span>)
<span class="fu"><a href="../reference/add_log.html">get_log</a></span>(<span class="no">world</span>)</pre></body></html></div>
</div>
<div id="logging-with-add_history" class="section level3">
<h3 class="hasAnchor">
<a href="#logging-with-add_history" class="anchor"></a>Logging with <code>add_history()</code>
</h3>
<p><code><a href="../reference/add_history.html">add_history()</a></code> has a more specific used and only applicable to <code>Entity</code>, it is meant to be used for logging of past events that occur to each entity. This is particularly useful when past actions of entities can influence their current and future actions. There are helper functions to get and combine histories such as <code><a href="../reference/get_history.html">get_history()</a></code> and <code><a href="../reference/combine_histories.html">combine_histories()</a></code>.</p>
<div class="sourceCode" id="cb27"><html><body><pre class="r"><span class="fu"><a href="../reference/create_toy_world.html">create_toy_world</a></span>(<span class="kw">add_toy_zones</span> <span class="kw">=</span> <span class="fl">FALSE</span>)
<span class="co">#&gt; [04:16:19] WARN  dymiumCore .subset2(public_bind_env, "initialize"): Creating a `hhsize` column in `hh_data` as it is not provided.</span>
<span class="fu"><a href="../reference/add_history.html">add_history</a></span>(<span class="kw">entity</span> <span class="kw">=</span> <span class="no">world</span>$<span class="no">entities</span>$<span class="no">Individual</span>, <span class="kw">ids</span> <span class="kw">=</span> <span class="fl">1</span>:<span class="fl">3</span>, <span class="kw">event</span> <span class="kw">=</span> <span class="st">"marriage"</span>)
<span class="fu"><a href="../reference/get_history.html">get_history</a></span>(<span class="kw">x</span> <span class="kw">=</span> <span class="no">world</span>$<span class="no">entities</span>$<span class="no">Individual</span>)
<span class="co">#&gt;    time created_timestamp    event pid</span>
<span class="co">#&gt; 1:    0        1595391379 marriage   1</span>
<span class="co">#&gt; 2:    0        1595391379 marriage   2</span>
<span class="co">#&gt; 3:    0        1595391379 marriage   3</span>
<span class="co"># alternatively you can use insepct to view the attribute data of the individuals</span>
<span class="co"># and their history data at the same time</span>
<span class="fu"><a href="../reference/inspect.html">inspect</a></span>(<span class="kw">entity</span> <span class="kw">=</span> <span class="no">world</span>$<span class="no">entities</span>$<span class="no">Individual</span>, <span class="kw">ids</span> <span class="kw">=</span> <span class="fl">1</span>:<span class="fl">3</span>)
<span class="co">#&gt; ℹ Attribute data of Individual</span>
<span class="co">#&gt;    pid hid age    sex marital_status partner_id father_id mother_id</span>
<span class="co">#&gt; 1:   1   1  71   male  never married         NA        NA        NA</span>
<span class="co">#&gt; 2:   2   2  31 female  never married         NA        NA        NA</span>
<span class="co">#&gt; 3:   3   2  29 female  never married         NA        NA        NA</span>
<span class="co">#&gt; ℹ History data of Individual</span>
<span class="co">#&gt;    time created_timestamp    event pid</span>
<span class="co">#&gt; 1:    0        1595391379 marriage   1</span>
<span class="co">#&gt; 2:    0        1595391379 marriage   2</span>
<span class="co">#&gt; 3:    0        1595391379 marriage   3</span></pre></body></html></div>
</div>
</div>
</div>
<div id="time-scale" class="section level1">
<h1 class="hasAnchor">
<a href="#time-scale" class="anchor"></a>Time scale</h1>
<p>Micosimulation models usually operate in cycle, where a cycle typically consider as 1 year for most discrete-time dynamic microsimulation models. However, this large time-step may not be preferrable to some events that may change more than once per year, such as employment status. Hence, these transitions in the real world may not be replicated in the simulated world. However, it is possible to mix events of different time scales in <code>dymiumCore</code> easily, using <code>Pipeline</code>.</p>
<p>First, let’s create three dummy microsimulation events. Let’s assume that Event 1 and Event 2 happen at the rate of every 3 months, while only Event 3 happens on an annual basis.</p>
<div class="sourceCode" id="cb28"><html><body><pre class="r"><span class="co"># create dummy events</span>
<span class="no">event_1</span> <span class="kw">&lt;-</span> <span class="kw">function</span>(<span class="no">x</span>) {
  <span class="fu"><a href="https://rdrr.io/r/base/print.html">print</a></span>(<span class="st">"Running event 1"</span>)
  <span class="fu"><a href="https://rdrr.io/r/base/invisible.html">invisible</a></span>(<span class="no">x</span>)
}

<span class="no">event_2</span> <span class="kw">&lt;-</span> <span class="kw">function</span>(<span class="no">x</span>) {
  <span class="fu"><a href="https://rdrr.io/r/base/print.html">print</a></span>(<span class="st">"Running event 2"</span>)
  <span class="fu"><a href="https://rdrr.io/r/base/invisible.html">invisible</a></span>(<span class="no">x</span>)
}

<span class="no">event_3</span> <span class="kw">&lt;-</span> <span class="kw">function</span>(<span class="no">x</span>) {
  <span class="fu"><a href="https://rdrr.io/r/base/print.html">print</a></span>(<span class="st">"Running event 3"</span>)
  <span class="fu"><a href="https://rdrr.io/r/base/invisible.html">invisible</a></span>(<span class="no">x</span>)
}

<span class="co"># Create a Pipeline that has only Event 1 and Event 2.</span>
<span class="no">quaterly_events</span> <span class="kw">&lt;-</span>
  <span class="no">Pipeline</span>$<span class="fu">new</span>(<span class="kw">x</span> <span class="kw">=</span> <span class="no">.</span> <span class="kw">%&gt;%</span>
                 <span class="fu">event_1</span>(<span class="no">.</span>) <span class="kw">%&gt;%</span>
                 <span class="fu">event_2</span>(<span class="no">.</span>))
<span class="co">#&gt; There are 2 functions in the pipeline.</span>
<span class="co">#&gt; 1. event_1(.)</span>
<span class="co">#&gt; 2. event_2(.)</span>

<span class="fu"><a href="../reference/create_toy_world.html">create_toy_world</a></span>(<span class="kw">add_toy_zones</span> <span class="kw">=</span> <span class="fl">FALSE</span>)
<span class="co">#&gt; [04:16:19] WARN  dymiumCore .subset2(public_bind_env, "initialize"): Creating a `hhsize` column in `hh_data` as it is not provided.</span>

<span class="co"># create a microsimulation pipeline that runs for 2 cycles or 2 years.</span>
<span class="kw">for</span> (<span class="no">i</span> <span class="kw">in</span> <span class="fl">1</span>:<span class="fl">2</span>) {
  <span class="fu"><a href="https://rdrr.io/r/base/print.html">print</a></span>(<span class="fu"><a href="https://rdrr.io/r/base/paste.html">paste0</a></span>(<span class="st">"Year: "</span>, <span class="no">i</span>))
  <span class="no">world</span>$<span class="fu">start_iter</span>(<span class="kw">time_step</span> <span class="kw">=</span> <span class="no">i</span>, <span class="kw">unit</span> <span class="kw">=</span> <span class="st">"year"</span>) <span class="kw">%&gt;%</span>
    <span class="no">quaterly_events</span>$<span class="fu">run</span>(<span class="no">.</span>, <span class="kw">n_loops</span> <span class="kw">=</span> <span class="fl">4</span>) <span class="kw">%&gt;%</span> <span class="co"># set to 4 == quaterly</span>
    <span class="fu">event_3</span>()
}
<span class="co">#&gt; [1] "Year: 1"</span>
<span class="co">#&gt; [1] "Running event 1"</span>
<span class="co">#&gt; [1] "Running event 2"</span>
<span class="co">#&gt; [1] "Running event 1"</span>
<span class="co">#&gt; [1] "Running event 2"</span>
<span class="co">#&gt; [1] "Running event 1"</span>
<span class="co">#&gt; [1] "Running event 2"</span>
<span class="co">#&gt; [1] "Running event 1"</span>
<span class="co">#&gt; [1] "Running event 2"</span>
<span class="co">#&gt; [1] "Running event 3"</span>
<span class="co">#&gt; [1] "Year: 2"</span>
<span class="co">#&gt; [1] "Running event 1"</span>
<span class="co">#&gt; [1] "Running event 2"</span>
<span class="co">#&gt; [1] "Running event 1"</span>
<span class="co">#&gt; [1] "Running event 2"</span>
<span class="co">#&gt; [1] "Running event 1"</span>
<span class="co">#&gt; [1] "Running event 2"</span>
<span class="co">#&gt; [1] "Running event 1"</span>
<span class="co">#&gt; [1] "Running event 2"</span>
<span class="co">#&gt; [1] "Running event 3"</span></pre></body></html></div>
<p>Notice that, we set <code>n_loops</code> equal to 4, which means the events inside <code>quaterly_events</code>, the Pipeline object that we have created, will be executed for 4 cycles before <code>event_3</code> will be run in each cycle of the for loop.</p>
</div>
  </div>

  <div class="col-md-3 hidden-xs hidden-sm" id="pkgdown-sidebar">

        <nav id="toc" data-toggle="toc"><h2 data-toc-skip>Contents</h2>
    </nav>
</div>

</div>



      <footer><div class="copyright">
  <p>Developed by Amarin Siripanich, Taha Rashidi.</p>
</div>

<div class="pkgdown">
  <p>Site built with <a href="https://pkgdown.r-lib.org/">pkgdown</a> 1.5.1.</p>
</div>

      </footer>
</div>

  
<script src="https://cdnjs.cloudflare.com/ajax/libs/docsearch.js/2.6.1/docsearch.min.js" integrity="sha256-GKvGqXDznoRYHCwKXGnuchvKSwmx9SRMrZOTh2g4Sb0=" crossorigin="anonymous"></script><script>
  docsearch({
    
    
    apiKey: '5b9cd61032daf2c5966b7cd693157aa2',
    indexName: 'dymiumcore',
    inputSelector: 'input#search-input.form-control',
    transformData: function(hits) {
      return hits.map(function (hit) {
        hit.url = updateHitURL(hit);
        return hit;
      });
    }
  });
</script>
</body>
</html>
