<!DOCTYPE html>
<!-- Generated by pkgdown: do not edit by hand --><html lang="en">
<head>
<meta http-equiv="Content-Type" content="text/html; charset=UTF-8">
<meta charset="utf-8">
<meta http-equiv="X-UA-Compatible" content="IE=edge">
<meta name="viewport" content="width=device-width, initial-scale=1.0">
<title>dymiumCore for modellers • dymiumCore</title>
<!-- favicons --><link rel="icon" type="image/png" sizes="16x16" href="../favicon-16x16.png">
<link rel="icon" type="image/png" sizes="32x32" href="../favicon-32x32.png">
<link rel="apple-touch-icon" type="image/png" sizes="180x180" href="../apple-touch-icon.png">
<link rel="apple-touch-icon" type="image/png" sizes="120x120" href="../apple-touch-icon-120x120.png">
<link rel="apple-touch-icon" type="image/png" sizes="76x76" href="../apple-touch-icon-76x76.png">
<link rel="apple-touch-icon" type="image/png" sizes="60x60" href="../apple-touch-icon-60x60.png">
<!-- jquery --><script src="https://cdnjs.cloudflare.com/ajax/libs/jquery/3.4.1/jquery.min.js" integrity="sha256-CSXorXvZcTkaix6Yvo6HppcZGetbYMGWSFlBw8HfCJo=" crossorigin="anonymous"></script><!-- Bootstrap --><link href="https://cdnjs.cloudflare.com/ajax/libs/bootswatch/3.4.0/readable/bootstrap.min.css" rel="stylesheet" crossorigin="anonymous">
<script src="https://cdnjs.cloudflare.com/ajax/libs/twitter-bootstrap/3.4.1/js/bootstrap.min.js" integrity="sha256-nuL8/2cJ5NDSSwnKD8VqreErSWHtnEP9E7AySL+1ev4=" crossorigin="anonymous"></script><!-- bootstrap-toc --><link rel="stylesheet" href="../bootstrap-toc.css">
<script src="../bootstrap-toc.js"></script><!-- Font Awesome icons --><link rel="stylesheet" href="https://cdnjs.cloudflare.com/ajax/libs/font-awesome/5.12.1/css/all.min.css" integrity="sha256-mmgLkCYLUQbXn0B1SRqzHar6dCnv9oZFPEC1g1cwlkk=" crossorigin="anonymous">
<link rel="stylesheet" href="https://cdnjs.cloudflare.com/ajax/libs/font-awesome/5.12.1/css/v4-shims.min.css" integrity="sha256-wZjR52fzng1pJHwx4aV2AO3yyTOXrcDW7jBpJtTwVxw=" crossorigin="anonymous">
<!-- clipboard.js --><script src="https://cdnjs.cloudflare.com/ajax/libs/clipboard.js/2.0.6/clipboard.min.js" integrity="sha256-inc5kl9MA1hkeYUt+EC3BhlIgyp/2jDIyBLS6k3UxPI=" crossorigin="anonymous"></script><!-- headroom.js --><script src="https://cdnjs.cloudflare.com/ajax/libs/headroom/0.11.0/headroom.min.js" integrity="sha256-AsUX4SJE1+yuDu5+mAVzJbuYNPHj/WroHuZ8Ir/CkE0=" crossorigin="anonymous"></script><script src="https://cdnjs.cloudflare.com/ajax/libs/headroom/0.11.0/jQuery.headroom.min.js" integrity="sha256-ZX/yNShbjqsohH1k95liqY9Gd8uOiE1S4vZc+9KQ1K4=" crossorigin="anonymous"></script><!-- pkgdown --><link href="../pkgdown.css" rel="stylesheet">
<script src="../pkgdown.js"></script><!-- docsearch --><script src="../docsearch.js"></script><link rel="stylesheet" href="https://cdnjs.cloudflare.com/ajax/libs/docsearch.js/2.6.3/docsearch.min.css" integrity="sha256-QOSRU/ra9ActyXkIBbiIB144aDBdtvXBcNc3OTNuX/Q=" crossorigin="anonymous">
<link href="../docsearch.css" rel="stylesheet">
<script src="https://cdnjs.cloudflare.com/ajax/libs/mark.js/8.11.1/jquery.mark.min.js" integrity="sha256-4HLtjeVgH0eIB3aZ9mLYF6E8oU5chNdjU6p6rrXpl9U=" crossorigin="anonymous"></script><meta property="og:title" content="dymiumCore for modellers">
<meta property="og:description" content="dymiumCore">
<meta property="og:image" content="https://core.dymium.org/logo.png">
<!-- mathjax --><script src="https://cdnjs.cloudflare.com/ajax/libs/mathjax/2.7.5/MathJax.js" integrity="sha256-nvJJv9wWKEm88qvoQl9ekL2J+k/RWIsaSScxxlsrv8k=" crossorigin="anonymous"></script><script src="https://cdnjs.cloudflare.com/ajax/libs/mathjax/2.7.5/config/TeX-AMS-MML_HTMLorMML.js" integrity="sha256-84DKXVJXs0/F8OTMzX4UR909+jtl4G7SPypPavF+GfA=" crossorigin="anonymous"></script><!--[if lt IE 9]>
<script src="https://oss.maxcdn.com/html5shiv/3.7.3/html5shiv.min.js"></script>
<script src="https://oss.maxcdn.com/respond/1.4.2/respond.min.js"></script>
<![endif]--><!-- Global site tag (gtag.js) - Google Analytics --><script async src="https://www.googletagmanager.com/gtag/js?id=UA-158512288-1"></script><script>
  window.dataLayer = window.dataLayer || [];
  function gtag(){dataLayer.push(arguments);}
  gtag('js', new Date());

  gtag('config', 'UA-158512288-1');
</script>
</head>
<body data-spy="scroll" data-target="#toc">
    <div class="container template-article">
      <header><div class="navbar navbar-default navbar-fixed-top" role="navigation">
  <div class="container">
    <div class="navbar-header">
      <button type="button" class="navbar-toggle collapsed" data-toggle="collapse" data-target="#navbar" aria-expanded="false">
        <span class="sr-only">Toggle navigation</span>
        <span class="icon-bar"></span>
        <span class="icon-bar"></span>
        <span class="icon-bar"></span>
      </button>
      <span class="navbar-brand">
        <a class="navbar-link" href="../index.html">dymiumCore</a>
        <span class="version label label-default" data-toggle="tooltip" data-placement="bottom" title="Released version">0.1.9.9000</span>
      </span>
    </div>

    <div id="navbar" class="navbar-collapse collapse">
      <ul class="nav navbar-nav">
<li>
  <a href="../index.html">
    <span class="fas fa fas fa-home fa-lg"></span>
     
  </a>
</li>
<li>
  <a href="../articles/dymium-intro.html">Introduction</a>
</li>
<li>
  <a href="../reference/index.html">Reference</a>
</li>
<li class="dropdown">
  <a href="#" class="dropdown-toggle" data-toggle="dropdown" role="button" aria-expanded="false">
    Articles
     
    <span class="caret"></span>
  </a>
  <ul class="dropdown-menu" role="menu">
<li>
      <a href="../articles/why-another-microsim.html">Why another microsimulation package?</a>
    </li>
    <li>
      <a href="../articles/publications.html">Publications</a>
    </li>
    <li class="dropdown-header">Manual</li>
    <li>
      <a href="../articles/for-developers.html">For developers (Work in progress)</a>
    </li>
    <li>
      <a href="../articles/for-modellers.html">For modellers</a>
    </li>
    <li>
      <a href="../articles/for-endusers.html">For end users (Work in progress)</a>
    </li>
    <li class="dropdown-header">Use cases</li>
    <li>
      <a href="../articles/residential-mobility.html">Residential mobility</a>
    </li>
    <li>
      <a href="../articles/mate-matching.html">Mate matching</a>
    </li>
    <li>
      <a href="../articles/marital-status.html">Marital status</a>
    </li>
  </ul>
</li>
<li>
  <a href="../news/index.html">News</a>
</li>
      </ul>
<ul class="nav navbar-nav navbar-right">
<li>
  <a href="https://github.com/dymium-org/dymiumCore/">
    <span class="fab fa fab fa-github fa-lg"></span>
     
  </a>
</li>
      </ul>
<form class="navbar-form navbar-right hidden-xs hidden-sm" role="search">
        <div class="form-group">
          <input type="search" class="form-control" name="search-input" id="search-input" placeholder="Search..." aria-label="Search for..." autocomplete="off">
</div>
      </form>
      
    </div>
<!--/.nav-collapse -->
  </div>
<!--/.container -->
</div>
<!--/.navbar -->

      

      </header><script src="for-modellers_files/accessible-code-block-0.0.1/empty-anchor.js"></script><div class="row">
  <div class="col-md-9 contents">
    <div class="page-header toc-ignore">
      <h1 data-toc-skip>dymiumCore for modellers</h1>
            
      
      <small class="dont-index">Source: <a href="https://github.com/dymium-org/dymiumCore/blob/master/vignettes/for-modellers.Rmd"><code>vignettes/for-modellers.Rmd</code></a></small>
      <div class="hidden name"><code>for-modellers.Rmd</code></div>

    </div>

    
    
<div id="introduction" class="section level1">
<h1 class="hasAnchor">
<a href="#introduction" class="anchor"></a>Introduction</h1>
<p>This manual is for people who would like to put together a microsimulation model using ready-to-use modules from <a href="https://github.com/dymium-org/dymiumModules">dymium-org/dymiumModules</a>. The most the you are willing to change are entity data and model parameters that go into your microsimulation model. If this is you then read on! :) otherwise please see the manual section and select the appropriate manual for you.</p>
</div>
<div id="requirements" class="section level1">
<h1 class="hasAnchor">
<a href="#requirements" class="anchor"></a>Requirements</h1>
<p>It is recommended that you setup a new RStudio project for your microsimulation project. See this <a href="https://support.rstudio.com/hc/en-us/articles/200526207-Using-Projects">page</a> if you are using RStudio but new to using Projects. If you don’t have RStudio please go ahead and download it at (rstudio.com).</p>
<p>Every module in <a href="https://github.com/dymium-org/dymiumModules">dymium-org/dymiumModules</a> repository relies on the <a href="https://cran.r-project.org/web/packages/modules/index.html">modules</a> package to work properly. Hence, make sure your have the package installed before using any module.</p>
</div>
<div id="modules" class="section level1">
<h1 class="hasAnchor">
<a href="#modules" class="anchor"></a>Modules</h1>
<p>It is important for a microsimulation model to be modular for greater maintainability and extendability. Your can read more about this discussion from <a href="https://www.researchgate.net/profile/Ann_Harding/publication/239806013_Problems_and_Prospects_for_Dynamic_Microsimulation_A_review_and_lessons_for_APPSIM/links/53e080520cf2aede4b4cca72/Problems-and-Prospects-for-Dynamic-Microsimulation-A-review-and-lessons-for-APPSIM.pdf">R Cassells, A Harding, S Kelly, 2006</a> and <a href="http://www.academia.edu/download/44911022/Integrated_Urban_Water_Modelling_-_Past_20160420-25966-stkce3.pdf">Eric Miller, 2019</a>.</p>
<p>In dymium, a module is basically a group of related events (i.e. ageing, giving birth and dying belong to the <code>demography</code> module). In fact, when we say dymium is modular we actually refer to the events that are being modular. This will be explained more in the next section.</p>
<div id="download-and-use-existing-modules" class="section level2">
<h2 class="hasAnchor">
<a href="#download-and-use-existing-modules" class="anchor"></a>Download and use existing modules</h2>
<p>I recommend that before you download any module you should first see its README page inside the repository. For example, if you want to know about the <code>demography</code> module or the events it has please see the <a href="https://github.com/dymium-org/dymiumModules/tree/master/modules/demography">dymium-org/dymiumModules</a> repository.</p>
<p>Once you are certain which module you want then use <code><a href="../reference/download_module.html">download_module()</a></code> to download that module into your project. This function allows modules to be downloaded into your project. For example, if you would like to download the <code>demography</code> module:</p>
<div class="sourceCode" id="cb1"><html><body><pre class="r"><span class="fu"><a href="../reference/download_module.html">download_module</a></span>(<span class="st">"demography"</span>)</pre></body></html></div>
<p>By default, this downloads the latest version of the <code>demography</code> module from <a href="https://github.com/dymium-org/dymiumModules">dymium-org/dymiumModules</a> into a newly created folder called <code>modules</code> at the root of project. See <code><a href="../reference/download_module.html">?download_module</a></code> for more download options.</p>
</div>
</div>
<div id="events" class="section level1">
<h1 class="hasAnchor">
<a href="#events" class="anchor"></a>Events</h1>
<p>The term <code>event</code> is used to refer to a process that is set to occur within a microsimulation model. For example, if your microsimulation model is for simulating the dynamic of population then you would have an ageing event, a birth event, a death event, and (optionally) a migration event. All events should be self-contained, meaning they do not need other events to be present to work. However, some events require other events. As an example, the <code>divorce</code> event from the <code>demography</code> module needs the <code>separate</code> event to work. This is because only people that can be divorced must first be in separation, which is simulated by the <code>separate</code> event.</p>
<div id="use-an-event" class="section level2">
<h2 class="hasAnchor">
<a href="#use-an-event" class="anchor"></a>Use an event</h2>
<p>Inside the <strong>demography</strong> module you will find a number of R scripts. <code>helpers.R</code>, <code>constants.R</code>, <code>logger.R</code>, <code>tests</code> folder are files and folder that got created when a new module is created using <code><a href="../reference/use_module.html">use_module()</a></code>. To learn more about them see the developer manual. The R scripts other than those are event scripts and they are the ones that you should import to your microsimulation model.</p>
<p>For example, if you would like to use the birth event which can be found at <code>your_project_folder/modules/demography/birth.R</code> in your microsimulation model do as the following:</p>
<div class="sourceCode" id="cb2"><html><body><pre class="r"><span class="no">event_demography_birth</span> <span class="kw">&lt;-</span> <span class="kw pkg">modules</span><span class="kw ns">::</span><span class="fu">use</span>(<span class="st">'modules/demography/birth.R'</span>)</pre></body></html></div>
<p>The above chuck imports the birth event into your active R environment by assigning it to a variable called <code>event_demography_birth</code>. Any event that is imported using <code>modules</code> have the following fields exposed: <code><a href="https://rdrr.io/pkg/future/man/run.html">run()</a></code> and <code>REQUIRED_MODELS</code>.</p>
<div class="sourceCode" id="cb3"><html><body><pre class="r"><span class="no">event_demography_birth</span>$<span class="fu">run</span>()</pre></body></html></div>
<p>The <code><a href="https://rdrr.io/pkg/future/man/run.html">run()</a></code> function of any event takes the same four main arguments which are <code>x</code>, <code>model</code>, <code>target</code>, <code>time_step</code>. Some <code><a href="https://rdrr.io/pkg/future/man/run.html">run()</a></code> functions may take more than the four main arguments. Therefore you should always check the README page of the module of the event that you are using.</p>
<div class="sourceCode" id="cb4"><html><body><pre class="r"><span class="no">event_demography_birth</span>$<span class="no">REQUIRED_MODELS</span></pre></body></html></div>
<p><code>REQUIRED_MODELS</code> is a field that contains <code>NULL</code> if no models are required by the event or a character vector. Anytime <code><a href="https://rdrr.io/pkg/future/man/run.html">run()</a></code> is called it will check if the supplied model argument or the supplied world has all the required models or not. If not then an error will appear.</p>
</div>
<div id="modify-an-event" class="section level2">
<h2 class="hasAnchor">
<a href="#modify-an-event" class="anchor"></a>Modify an event</h2>
<p>At some point, you may find yourself wanting to include some additional variables to a model but those variables don’t exist in the attribute data of your agents. Those additional variables maybe variables that get generated during the simulation (such as the length of the current marriage, the age of the youngest child, the number of divorces) or derive from an existing attribute (such as age in 5-year age group etc.). These can be easily included in the <code>Transition</code> object of your model.</p>
<p>For example, in the birth event of the demography module there is a <code>TransitionBirth</code> class that is extended from <code>TransitionClassification</code>.</p>
<div class="sourceCode" id="cb5"><html><body><pre class="r"><span class="co"># See https://github.com/dymium-org/dymiumModules/blob/d53fdb47680efc9a05e56f0c420c85907e73794e/modules/demography/birth.R#L147-L167</span>
<span class="no">TransitionBirth</span> <span class="kw">&lt;-</span> <span class="fu">R6Class</span>(
  <span class="kw">classname</span> <span class="kw">=</span> <span class="st">"TransitionBirth"</span>,
  <span class="kw">inherit</span> <span class="kw">=</span> <span class="kw pkg">dymiumCore</span><span class="kw ns">::</span><span class="no"><a href="../reference/TransitionClassification.html">TransitionClassification</a></span>,
  <span class="kw">public</span> <span class="kw">=</span> <span class="fu"><a href="https://rdrr.io/r/base/list.html">list</a></span>(
    <span class="kw">filter</span> <span class="kw">=</span> <span class="kw">function</span>(<span class="no">.data</span>) {
      <span class="no">.data</span> <span class="kw">%&gt;%</span>
        <span class="no">helpers</span>$<span class="no">FilterAgent</span>$<span class="no">Ind</span>$<span class="fu">can_give_birth</span>(<span class="no">.</span>)<span class="co"># %&gt;%</span>
        <span class="co"># helpers$FilterAgent$Ind$is_in_relationship(.)</span>
    },
    <span class="kw">mutate</span> <span class="kw">=</span> <span class="kw">function</span>(<span class="no">.data</span>) {
      <span class="no">Ind</span> <span class="kw">&lt;-</span> <span class="no">private</span>$<span class="no">.AgtObj</span>
      <span class="no">.data</span> <span class="kw">%&gt;%</span>
        <span class="no">helpers</span>$<span class="no">DeriveVar</span>$<span class="no">IND</span>$<span class="fu">has_resident_children</span>(<span class="kw">x</span> <span class="kw">=</span> <span class="no">.</span>, <span class="no">Ind</span>) <span class="kw">%&gt;%</span>
        <span class="no">helpers</span>$<span class="no">DeriveVar</span>$<span class="no">IND</span>$<span class="fu">n_resident_children</span>(<span class="kw">x</span> <span class="kw">=</span> <span class="no">.</span>, <span class="no">Ind</span>) <span class="kw">%&gt;%</span>
        <span class="no">helpers</span>$<span class="no">DeriveVar</span>$<span class="no">IND</span>$<span class="fu">age_youngest_resident_child</span>(<span class="kw">x</span> <span class="kw">=</span> <span class="no">.</span>, <span class="no">Ind</span>) <span class="kw">%&gt;%</span>
        <span class="no">helpers</span>$<span class="no">DeriveVar</span>$<span class="no">IND</span>$<span class="fu">age5</span>(<span class="kw">x</span> <span class="kw">=</span> <span class="no">.</span>, <span class="no">Ind</span>) <span class="kw">%&gt;%</span>
        <span class="no">helpers</span>$<span class="no">DeriveVar</span>$<span class="no">IND</span>$<span class="fu">n_children</span>(<span class="kw">x</span> <span class="kw">=</span> <span class="no">.</span>, <span class="no">Ind</span>) <span class="kw">%&gt;%</span>
        <span class="no">helpers</span>$<span class="no">DeriveVar</span>$<span class="no">IND</span>$<span class="fu">mrs</span>(<span class="kw">x</span> <span class="kw">=</span> <span class="no">.</span>, <span class="no">Ind</span>)
    }
  )
)</pre></body></html></div>
<p><code>TransitionBirth</code> has two implemented methods that <code>TransitionClassification</code> doesn’t have which are <code><a href="https://rdrr.io/r/stats/filter.html">filter(.data)</a></code> and <code>mutate(.data)</code>.</p>
<p>The <code>filter</code> method defines the criteria which the agents must meet to undergo this <code>TransitionBirth</code> transition, which is to give birth. <code>helpers$FilterAgent$Ind$can_give_birth(x)</code>, a function defined in <code>helpers.R</code>, filters only those agents that are women with age between <code>RULES$GIVE_BIRTH$AGE_LOWER_BOUND</code> and <code>RULES$GIVE_BIRTH$AGE_UPPER_BOUND</code>. The age rules can be found in <code>constants.R</code> and they can be changed to suit your assumption.</p>
<div class="sourceCode" id="cb6"><html><body><pre class="r"><span class="no">helpers</span>$<span class="no">FilterAgent</span>$<span class="no">Ind</span>$<span class="no">can_give_birth</span> <span class="kw">=</span> <span class="kw">function</span>(<span class="no">x</span>) {
  <span class="fu">get_individual_data</span>(<span class="no">x</span>) <span class="kw">%&gt;%</span>
    <span class="no">.</span>[<span class="no">sex</span> <span class="kw">==</span> <span class="no">IND</span>$<span class="no">SEX</span>$<span class="no">FEMALE</span> <span class="kw">&amp;</span>
        <span class="no">age</span> <span class="kw">%between%</span> <span class="fu"><a href="https://rdrr.io/r/base/c.html">c</a></span>(<span class="no">RULES</span>$<span class="no">GIVE_BIRTH</span>$<span class="no">AGE_LOWER_BOUND</span>,
                        <span class="no">RULES</span>$<span class="no">GIVE_BIRTH</span>$<span class="no">AGE_UPPER_BOUND</span>)]
}</pre></body></html></div>
<p>While the <code>mutate(.data)</code> method allows you to add additional variables to be used as predictors in your model. As you can see, there are quite a few additional variables that get added to the agent data from the number of children, the age of the youngest residential child, etc.</p>
<p>By default the filter data from <code><a href="https://rdrr.io/r/stats/filter.html">filter()</a></code> will be passed to the <code>mutate(.data)</code> function then to the <code>simulate</code> function of <code>Transition</code>. However, this order can be changed in case you need to filter agents based on a derived variable by setting the <code>mutate_first</code> field equal to <code>TRUE</code>.</p>
<div class="sourceCode" id="cb7"><html><body><pre class="r"><span class="no">TransitionBirth</span> <span class="kw">&lt;-</span> <span class="fu">R6Class</span>(
  <span class="kw">classname</span> <span class="kw">=</span> <span class="st">"TransitionBirth"</span>,
  <span class="kw">inherit</span> <span class="kw">=</span> <span class="kw pkg">dymiumCore</span><span class="kw ns">::</span><span class="no"><a href="../reference/TransitionClassification.html">TransitionClassification</a></span>,
  <span class="kw">public</span> <span class="kw">=</span> <span class="fu"><a href="https://rdrr.io/r/base/list.html">list</a></span>(
    <span class="kw">filter</span> <span class="kw">=</span> <span class="kw">function</span>(<span class="no">.data</span>) {
      <span class="no">.data</span> <span class="kw">%&gt;%</span>
        <span class="no">helpers</span>$<span class="no">FilterAgent</span>$<span class="no">Ind</span>$<span class="fu">can_give_birth</span>(<span class="no">.</span>)<span class="co"># %&gt;%</span>
        <span class="co"># helpers$FilterAgent$Ind$is_in_relationship(.)</span>
    },
    <span class="kw">mutate</span> <span class="kw">=</span> <span class="kw">function</span>(<span class="no">.data</span>) {
      <span class="no">Ind</span> <span class="kw">&lt;-</span> <span class="no">private</span>$<span class="no">.AgtObj</span>
      <span class="no">.data</span> <span class="kw">%&gt;%</span>
        <span class="no">helpers</span>$<span class="no">DeriveVar</span>$<span class="no">IND</span>$<span class="fu">has_resident_children</span>(<span class="kw">x</span> <span class="kw">=</span> <span class="no">.</span>, <span class="no">Ind</span>) <span class="kw">%&gt;%</span>
        <span class="no">helpers</span>$<span class="no">DeriveVar</span>$<span class="no">IND</span>$<span class="fu">n_resident_children</span>(<span class="kw">x</span> <span class="kw">=</span> <span class="no">.</span>, <span class="no">Ind</span>) <span class="kw">%&gt;%</span>
        <span class="no">helpers</span>$<span class="no">DeriveVar</span>$<span class="no">IND</span>$<span class="fu">age_youngest_resident_child</span>(<span class="kw">x</span> <span class="kw">=</span> <span class="no">.</span>, <span class="no">Ind</span>) <span class="kw">%&gt;%</span>
        <span class="no">helpers</span>$<span class="no">DeriveVar</span>$<span class="no">IND</span>$<span class="fu">age5</span>(<span class="kw">x</span> <span class="kw">=</span> <span class="no">.</span>, <span class="no">Ind</span>) <span class="kw">%&gt;%</span>
        <span class="no">helpers</span>$<span class="no">DeriveVar</span>$<span class="no">IND</span>$<span class="fu">n_children</span>(<span class="kw">x</span> <span class="kw">=</span> <span class="no">.</span>, <span class="no">Ind</span>) <span class="kw">%&gt;%</span>
        <span class="no">helpers</span>$<span class="no">DeriveVar</span>$<span class="no">IND</span>$<span class="fu">mrs</span>(<span class="kw">x</span> <span class="kw">=</span> <span class="no">.</span>, <span class="no">Ind</span>)
    },
    <span class="kw">mutate_first</span> <span class="kw">=</span> <span class="fl">TRUE</span> <span class="co"># mutate before filter !!!</span>
  )
)</pre></body></html></div>
</div>
</div>
<div id="lets-put-together-a-microsimulation-model" class="section level1">
<h1 class="hasAnchor">
<a href="#lets-put-together-a-microsimulation-model" class="anchor"></a>Let’s put together a microsimulation model</h1>
<div id="single-run" class="section level2">
<h2 class="hasAnchor">
<a href="#single-run" class="anchor"></a>Single run</h2>
<p>Putting together a microsimulation model using <code>dymium</code> is very simple. Once you have your <code>world</code> object constructed with all the necessary entities and models for your incluced event functions you just need to create a flow-control statement such as a for-loop which exits at some point.</p>
<p>In the example below, the simulation will be stopped after the 10th iteration. Note that, <code>world</code> has a <code>$start_iter()</code> method which sets the simulation clock to the time_step in <code>i</code> before returning itself down the pipeline. The time from the simulation clock is used by many functions such as <code>add_history</code>, <code>Generic$log()</code> and <code>is_scheduled</code>. Therefore, we recommend that you use the <code>$start_iter()</code> method to pass the world object down the pipeline in your microsimulation model setup.</p>
<div class="sourceCode" id="cb8"><html><body><pre class="r"><span class="kw">for</span> (<span class="no">i</span> <span class="kw">in</span> <span class="fl">1</span>:<span class="fl">10</span>) {
  <span class="no">world</span>$<span class="fu">start_iter</span>(<span class="kw">time_step</span> <span class="kw">=</span> <span class="no">i</span>, <span class="kw">unit</span> <span class="kw">=</span> <span class="st">"year"</span>) <span class="kw">%&gt;%</span>
    <span class="no">event_1</span>$<span class="fu">run</span>(<span class="no">.</span>) <span class="kw">%&gt;%</span>
    <span class="no">event_2</span>$<span class="fu">run</span>(<span class="no">.</span>)
}</pre></body></html></div>
</div>
<div id="parallel-runs" class="section level2">
<h2 class="hasAnchor">
<a href="#parallel-runs" class="anchor"></a>Parallel runs</h2>
<p>Microsimulation models rely randomly number generators to produce their simulation results, the results between different runs are very unlikely to be identical. Hence, to validate the model or to conduct a sensitivity analysis it is a good idea to run the same simulation setup multiple times and analyse the variance of the results.</p>
<p>To do that here is a simple example using the <code>future</code> and <code>furrr</code> packages.</p>
<div class="sourceCode" id="cb9"><html><body><pre class="r"><span class="fu"><a href="https://rdrr.io/r/base/library.html">library</a></span>(<span class="no">future</span>)
<span class="fu"><a href="https://rdrr.io/r/base/library.html">library</a></span>(<span class="no">furrr</span>)

<span class="no">cl</span> <span class="kw">&lt;-</span> <span class="fu"><a href="https://rdrr.io/pkg/future/man/makeClusterPSOCK.html">makeClusterPSOCK</a></span>(<span class="kw">workers</span> <span class="kw">=</span> <span class="fl">2</span>)
<span class="kw pkg">future</span><span class="kw ns">::</span><span class="fu"><a href="https://rdrr.io/pkg/future/man/plan.html">plan</a></span>(<span class="no">cluster</span>, <span class="kw">workers</span> <span class="kw">=</span> <span class="no">cl</span>)

<span class="no">res</span> <span class="kw">&lt;-</span> <span class="kw pkg">furrr</span><span class="kw ns">::</span><span class="fu"><a href="https://rdrr.io/pkg/furrr/man/future_map.html">future_map</a></span>(<span class="fl">1</span>:<span class="fl">4</span>, ~ {
  <span class="no">world</span> <span class="kw">&lt;-</span> <span class="fu"><a href="https://rdrr.io/r/base/readRDS.html">readRDS</a></span>(<span class="st">"path/to/world.rds"</span>)
  <span class="kw">for</span> (<span class="no">i</span> <span class="kw">in</span> <span class="fl">1</span>:<span class="fl">10</span>) {
    <span class="no">world</span>$<span class="fu">start_iter</span>(<span class="kw">time_step</span> <span class="kw">=</span> <span class="no">i</span>, <span class="kw">unit</span> <span class="kw">=</span> <span class="st">"year"</span>) <span class="kw">%&gt;%</span>
      <span class="no">event_1</span>$<span class="fu"><a href="https://rdrr.io/pkg/future/man/run.html">run</a></span>(<span class="no">.</span>) <span class="kw">%&gt;%</span>
      <span class="no">event_2</span>$<span class="fu"><a href="https://rdrr.io/pkg/future/man/run.html">run</a></span>(<span class="no">.</span>)
  }
  <span class="fu"><a href="https://rdrr.io/r/base/function.html">return</a></span>(<span class="no">world</span>)
})

<span class="kw pkg">parallel</span><span class="kw ns">::</span><span class="fu"><a href="https://rdrr.io/r/parallel/makeCluster.html">stopCluster</a></span>(<span class="no">cl</span>)</pre></body></html></div>
</div>
</div>
  </div>

  <div class="col-md-3 hidden-xs hidden-sm" id="pkgdown-sidebar">

        <nav id="toc" data-toggle="toc"><h2 data-toc-skip>Contents</h2>
    </nav>
</div>

</div>



      <footer><div class="copyright">
  <p>Developed by Amarin Siripanich, Taha Rashidi.</p>
</div>

<div class="pkgdown">
  <p>Site built with <a href="https://pkgdown.r-lib.org/">pkgdown</a> 1.5.1.</p>
</div>

      </footer>
</div>

  
<script src="https://cdnjs.cloudflare.com/ajax/libs/docsearch.js/2.6.1/docsearch.min.js" integrity="sha256-GKvGqXDznoRYHCwKXGnuchvKSwmx9SRMrZOTh2g4Sb0=" crossorigin="anonymous"></script><script>
  docsearch({
    
    
    apiKey: '5b9cd61032daf2c5966b7cd693157aa2',
    indexName: 'dymiumcore',
    inputSelector: 'input#search-input.form-control',
    transformData: function(hits) {
      return hits.map(function (hit) {
        hit.url = updateHitURL(hit);
        return hit;
      });
    }
  });
</script>
</body>
</html>
